Unknown [1c00000000000000000031200000000000000000]SectionQBKey default_ui_visualizer_preset TB_Mod_NullSectionQBKey g_current_ui_visualizer NoneSectionArray venues_requiring_visualizer{	ArrayQBKey	[		Z_EpicStage		z_demons		Z_PunkStage		Z_Riothouse		Z_MansionStudio		Z_Egypt		Z_Festival		Z_Modular		Z_FinalBattle		z_credits		Z_Cube		z_Visualizer	]}SectionInteger movie_viewport_created 0Script create_movie_viewport 0x56d3105e [	:i if (~$movie_viewport_created$ = %i(0))		:i $create_visualizer$		:i $create_jumbotron$		:i $create_bandname_viewport$		:i $change$${StructInt movie_viewport_created = 1}$	:i endif	:i endfunction]SectionStruct jumbotron_viewport_params{	StructHeader	{		StructQBKey viewport = jumbotron_viewport		StructQBKey textureasset = tex\zones\Metalfest\JG_MF_TVScreen_D.dds		StructQBKey style = jumbotron_rendering		StructQBKey name = jumbotron_cam	}}SectionQBKey current_jumbotron NoneScript create_jumbotron 0x820c27e5 [	:i $GetPakManCurrentName$${StructQBKey map = zones}$	:i $jumbotron$ = $jumbotron_viewport_params$	:i if NOT $globalexists$$name$ = %GLOBAL%$jumbotron$		:i return 	:i endif	:i $AddParams$(~%GLOBAL%$jumbotron$)	:i $FormatText$$checksumname$ = $texdict$%s("zones/%s/%t.tex")$s$ = %GLOBAL%$pakname$$t$ = %GLOBAL%$pakname$	:i $FormatText$$checksumname$ = $zone_context$%s("%t")$t$ = %GLOBAL%$pakname$	:i $PushAssetContext$$context$ = %GLOBAL%$zone_context$	:i if NOT $IsAssetLoaded$$name$ = %GLOBAL%$texdict$		:i $printf$${StructString 0x00000000 = "Zone texdict not found for jumbotron"}$		:i $PopAssetContext$		:i return 	:i endif	:i if NOT $IsTextureInDictionary$$dictionary$ = %GLOBAL%$texdict$$texture$ = %GLOBAL%$textureasset$		:i $printf$%s("Nowhere to put Jumbotron in %s")$s$ = %GLOBAL%$pakname$		:i $PopAssetContext$		:i return 	:i endif	:i $PopAssetContext$	:i $FormatText$$checksumname$ = $cameraparams$%s("%s_cameras_closeups")$s$ = %GLOBAL%$pakname$	:i if NOT $globalexists$$name$ = %GLOBAL%$cameraparams$		:i $FormatText$$checksumname$ = $cameraparams$%s("%s_cameras_singer")$s$ = %GLOBAL%$pakname$		:i if NOT $globalexists$$name$ = %GLOBAL%$cameraparams$			:i $printf$${StructQBStringQs 0x78c7dc47}$			:i return 		:i endif	:i endif	:i $change$$current_jumbotron$ = ~%GLOBAL%$jumbotron$	:i $CreateViewport$:s{		:i $priority$ = %i(6)		:i $id$ = %GLOBAL%$viewport$		:i $style$ = %GLOBAL%$style$		:i $jiggle_rendering$ = %i(2)		:i $use_lod_shader$ = $true$	:i :s}	:i $change$$jumbotron_camera_params$ = ~%GLOBAL%$cameraparams$	:i $change$${StructInt jumbotron_camera_index = 0}$	:i $jumbotron_camera_startcallback$ isNull 	:i $setsearchallassetcontexts$	:i $CreateViewportTextureOverride$:s{		:i $id$ = %GLOBAL%$viewport$		:i $viewportid$ = %GLOBAL%$viewport$		:i $texture$ = %GLOBAL%$textureasset$		:i $texdict$ = %GLOBAL%$texdict$	:i :s}	:i $setsearchallassetcontexts$${StructQBKey Off}$	:i endfunction]SectionInteger jumbotron_camera_index 0SectionQBKey jumbotron_camera_params NoneScript jumbotron_camera_startcallback 0x77a948c3 [	:i $jumbotron$ = ~$current_jumbotron$	:i if (%GLOBAL%$jumbotron$ = $None$)		:i return 	:i endif	:i $AddParams$(%GLOBAL%$jumbotron$)	:i if NOT $GotParam$${StructQBKey pakname}$		:i return 	:i endif	:i switch (~$jumbotron_focus$)		:i case $guitarist$			:i $FormatText$$checksumname$ = $cameraparams$%s("%s_cameras_guitarist")$s$ = %GLOBAL%$pakname$			:i endcase		case $bassist$			:i $FormatText$$checksumname$ = $cameraparams$%s("%s_cameras_bassist")$s$ = %GLOBAL%$pakname$			:i endcase		case $vocalist$			:i $FormatText$$checksumname$ = $cameraparams$%s("%s_cameras_singer")$s$ = %GLOBAL%$pakname$			:i endcase		case $drummer$			:i $FormatText$$checksumname$ = $cameraparams$%s("%s_cameras_drummer")$s$ = %GLOBAL%$pakname$			:i endcase		default 			:i $FormatText$$checksumname$ = $cameraparams$%s("%s_cameras_closeups")$s$ = %GLOBAL%$pakname$	:i end_switch	:i if NOT $globalexists$$name$ = %GLOBAL%$cameraparams$		:i $FormatText$$checksumname$ = $cameraparams$%s("%s_cameras_singer")$s$ = %GLOBAL%$pakname$		:i if NOT $globalexists$$name$ = %GLOBAL%$cameraparams$			:i $printf$${StructQBStringQs 0x78c7dc47}$			:i return 		:i endif	:i endif	:i $current_index$ = (~$jumbotron_camera_index$)	:i $GetArraySize$(~$jumbotron_camera_params$)	:i $current_index$ = (%GLOBAL%$current_index$ + %i(1))	:i if (%GLOBAL%$current_index$ = %GLOBAL%$array_size$)		:i $current_index$ = %i(0)	:i endif	:i $change$$jumbotron_camera_index$ = %GLOBAL%$current_index$	:i if (~$debug_show_camera_name$ = %i(1))		:i $CameraCuts_UpdateDebugCameraName$	:i endif	:i $force_time$ = %i(5)	:i if $StructureContains$$structure$ = ((~$jumbotron_camera_params$):a{%GLOBAL%$current_index$:a})$params$		:i $params$ = :s{((~$jumbotron_camera_params$):a{%GLOBAL%$current_index$:a}->$params$)$force_time$ = %GLOBAL%$force_time$:s}	:i else 		:i $params$ = :s{$camparams$ = ((~$jumbotron_camera_params$):a{%GLOBAL%$current_index$:a})$force_time$ = %GLOBAL%$force_time$:s}	:i endif	:i $PlayIGCCam$:s{		:i $name$ = %GLOBAL%$name$		:i $viewport$ = %GLOBAL%$viewport$		:i $LockTo$ = $world$		:i $ControlScript$ = $CameraCuts_StaticCamControl$		:i ((~$jumbotron_camera_params$):a{%GLOBAL%$current_index$:a})		:i $params$ = %GLOBAL%$params$		:i $exitscript$ = $jumbotron_camera_startcallback$	:i :s}	:i endfunction]Script destroy_jumbotron cee6fd6f [	:i $jumbotron$ = ~$current_jumbotron$	:i if (%GLOBAL%$jumbotron$ = $None$)		:i return 	:i endif	:i $AddParams$(%GLOBAL%$jumbotron$)	:i $KillCamAnim$$name$ = %GLOBAL%$name$	:i $setsearchallassetcontexts$	:i $DestroyViewportTextureOverride$$id$ = %GLOBAL%$viewport$	:i $setsearchallassetcontexts$${StructQBKey Off}$	:i $DestroyViewport$$id$ = %GLOBAL%$viewport$	:i $change$${StructQBKey current_jumbotron = None}$	:i endfunction]Script destroy_movie_viewport b56874fd [	:i if (~$movie_viewport_created$ = %i(1))		:i $Destroy_visualizer$		:i $destroy_jumbotron$		:i $destroy_bandname_viewport$		:i $change$${StructInt movie_viewport_created = 0}$	:i endif	:i endfunction]Script create_visualizer_fx 0x6a6995ad [	:i if $ScreenFX_FXInstanceExists$$viewport$ = %GLOBAL%$viewport$$name$ = $AV_Test0$		:i $ScreenFX_ClearFXInstances$:s{$viewport$ = %GLOBAL%$viewport$:s}	:i endif	:i $wait$${		StructInt 1		StructQBKey gameframe	}$		:i $ScreenFX_AddFXInstance$:s{		:i $viewport$ = %GLOBAL%$viewport$		:i $name$ = $AV_Test0$		:i $scefName$ = $AV_Test0$		:i $type$ = $AudioVisualize$		:i $on$ = %i(1)		:i $primitives$ = ~$green_line_primitives$	:i :s}	:i endfunction]SectionArray preset_redstreak{	ArrayStruct	[		StructHeader		{			StructQBKey type = BlendPrev			StructFloat AngularVel = 0.00			StructFloatX2 Scale			{				Floats [1.00000, 1.25000]			}			StructArray color			{				ArrayInteger				[					104					64					224					255				]			}			StructQBKey BlendMode = Blend		}		StructHeader		{			StructQBKey type = Line			StructFloatX3 Pos			{				Floats [0.500000, 0.250000, 0.00000]			}			StructFloat Length = 1.00			StructFloat AngularVel = 0.00			StructArray controls			{				ArrayStruct				[					StructHeader					{						StructQBKey type = Frequency						StructQBKey Response = Deform						StructQBKey ResponseFunc = Log10						StructInt DeformScale = 100					}								]			}		}		StructHeader		{			StructQBKey type = BlendPrev			StructFloat AngularVel = 0.00			StructFloatX2 Scale			{				Floats [-1.00000, -0.950000]			}			StructArray color			{				ArrayInteger				[					244					74					184					255				]			}			StructQBKey BlendMode = Blend		}		]}SectionArray green_line_primitives{	ArrayStruct	[		StructHeader		{			StructQBKey type = BlendPrev			StructFloat AngularVel = 0.00			StructFloatX2 Scale			{				Floats [1.00000, 1.00000]			}			StructArray color			{				ArrayInteger				[					250					250					250					255				]			}			StructQBKey BlendMode = Blend		}		StructHeader		{			StructQBKey type = Line			StructArray color			{				ArrayInteger				[					250					200					50					255				]			}			StructFloatX3 Pos			{				Floats [0.500000, 0.750000, 0.00000]			}			StructInt Length = 1			StructInt Thickness = 2			StructInt AngularVel = 0			StructArray controls			{				ArrayStruct				[					StructHeader					{						StructQBKey type = Frequency						StructQBKey Response = Deform						StructInt SpectrumBand = 18						StructQBKey ResponseFunc = Log10						StructInt DeformScale = 20					}								]			}		}		StructHeader		{			StructQBKey type = Line			StructArray color			{				ArrayInteger				[					250					100					50					255				]			}			StructFloatX3 Pos			{				Floats [0.500000, 0.150000, 0.00000]			}			StructInt Length = 1			StructInt Thickness = 2			StructInt AngularVel = 0			StructArray controls			{				ArrayStruct				[					StructHeader					{						StructQBKey type = Frequency						StructQBKey Response = Deform						StructInt SpectrumBand = 18						StructQBKey ResponseFunc = SinLog10						StructInt DeformScale = 20					}								]			}		}		StructHeader		{			StructQBKey type = Line			StructArray color			{				ArrayInteger				[					250					200					250					255				]			}			StructFloatX3 Pos			{				Floats [0.500000, 0.0500000, 0.00000]			}			StructInt Length = 1			StructInt Thickness = 2			StructInt AngularVel = 0			StructArray controls			{				ArrayStruct				[					StructHeader					{						StructQBKey type = Frequency						StructQBKey Response = Deform						StructInt SpectrumBand = 18						StructQBKey ResponseFunc = SinLog10						StructInt DeformScale = 0					}								]			}		}		StructHeader		{			StructQBKey type = BlendPrev			StructFloat AngularVel = 0.00			StructFloatX2 Scale			{				Floats [-1.20000, 1.20000]			}			StructArray color			{				ArrayInteger				[					100					100					110					160				]			}			StructQBKey BlendMode = Add		}		StructHeader		{			StructQBKey type = BlendPrev			StructFloat AngularVel = 0.10000000149011612			StructFloatX2 Scale			{				Floats [1.50000, 1.00000]			}			StructArray color			{				ArrayInteger				[					110					100					100					118				]			}			StructQBKey BlendMode = Sub		}		]}SectionStruct visualizer_viewport_params{	StructHeader	{		StructQBKey viewport = visualizer_viewport		StructArray textureassets		{			ArrayQBKey			[				tex\zones\Z_visualizer\OG_visualizer.dds			]		}		StructQBKey style = visualizer_rendering		StructQBKey name = visualizer_cam	}}SectionQBKey current_visualizer NoneSectionQBKey current_visualizer_2D trueSectionQBKey use_60fps_visualizer trueScript create_visualizer_screen_element 0x483d931d [	${StructInt z_priority = -500}$	:i $destroy_visualizer_screen_element$	:i $visualizer_viewport_wait_for_dead$	:i $SetSpecificRenderTargetHeap$${StructQBKey heap_jam_vram}$	:i $CreateScreenElement$:s{		:i $parent$ = $root_window$		:i $type$ = $viewportelement$		:i $id$ = $fullscreen_visualizer_viewport$		:i $texture$ = $fullscreen_visualizer$		:i $viewport_priority$ = %i(1)		:i $Pos$ = %vec2(0.0,0.0)		:i $just$ = :a{$left$$top$:a}		:i $dims$ = %vec2(1280.0,720.0)		:i $rgba$ = :a{%i(255)%i(255)%i(255)%i(255):a}		:i $alpha$ = %i(1)		:i $Blend$ = $diffuse$		:i $style$ = $visualizer_rendering_hires$		:i $color_only$		:i $rect$ = :a{%f(0.0),%f(0.0),%f(1.0),%f(1.0):a}		:i $width$ = %i(1280)		:i $height$ = %i(720)		:i $resolve_to_prev_texture_with_alpha$		:i $render_to_texture$		:i $managed$		:i $framerate$ = %i(60)		:i $framemask$ = %i(3)		:i $resolution$ = %f(1.0)		:i $uidims$ = %vec2(1280.0,720.0)		:i $z_priority$ = %GLOBAL%$z_priority$	:i :s}	:i $SetSpecificRenderTargetHeap$	:i if $ScreenElementExists$${StructQBKey id = fullscreen_visualizer_viewport}$		:i $engineConfig$${StructInt LightVolume = 0}$	:i endif	:i endfunction]Script destroy_visualizer_screen_element 0x97f0a4e6 [	:i if $ScreenElementExists$${StructQBKey id = fullscreen_visualizer_viewport}$		:i $DestroyScreenElement$${StructQBKey id = fullscreen_visualizer_viewport}$		:i $engineConfig$${StructInt LightVolume = 1}$	:i endif	:i endfunction]Script visualizer_viewport_wait_for_dead cd8258d7 [	:i $printf$${StructString 0x00000000 = "visualizer_viewport_wait_for_dead - start"}$	:i while 	:i if NOT $ViewportExists$${			StructQBKey id = fullscreen_visualizer_viewport			StructInt check_dead = 1		}$				:i continue	:i endif	:i $printf$${StructString 0x00000000 = "Waiting for visualizer viewport to die"}$	:i $wait$${		StructInt 1		StructQBKey gameframe	}$		:i loop_to 	:i $printf$${StructString 0x00000000 = "visualizer_viewport_wait_for_dead - viewport is dead"}$	:i while 	:i if NOT $RenderTargetsPendingDeletion$		:i continue	:i endif	:i $printf$${StructString 0x00000000 = "Waiting for visualizer rendertarget to die"}$	:i $wait$${		StructInt 1		StructQBKey gameframe	}$		:i loop_to 	:i $printf$${StructString 0x00000000 = "visualizer_viewport_wait_for_dead - rendertarget is dead"}$	:i endfunction]Script create_visualizer bfd2b964 [	:i $GetPakManCurrent$${StructQBKey map = zones}$	:i if NOT $ArrayContains$$array$ = (~$venues_requiring_visualizer$)$contains$ = %GLOBAL%$pak$		:i $Destroy_visualizer$		:i return 	:i endif	:i $change$${StructQBKey visualizer_Events_Enabled = true}$	:i $visualizer$ = $visualizer_viewport_params$	:i if NOT $globalexists$$name$ = %GLOBAL%$visualizer$		:i return 	:i endif	:i $destroy_visualizer_screen_element$	:i if (%GLOBAL%$pak$ = $z_Visualizer$)		:i if (~$use_60fps_visualizer$ = $true$)			:i $create_visualizer_screen_element$		:i endif	:i endif	:i $GetPakManCurrentName$${StructQBKey map = zones}$	:i $FormatText$$checksumname$ = $fx_func$%s("create_visualizer_fx_2D_%s")$s$ = %GLOBAL%$pakname$	:i if $ScriptExists$%GLOBAL%$fx_func$		:i %GLOBAL%$fx_func$$viewport$ = $bg_viewport$		:i $change$$current_visualizer$ = ~%GLOBAL%$visualizer$		:i $change$${StructQBKey current_visualizer_2D = true}$		:i return 	:i endif	:i $AddParams$(~%GLOBAL%$visualizer$)	:i $FormatText$$checksumname$ = $texdict$%s("zones/%s/%t.tex")$s$ = %GLOBAL%$pakname$$t$ = %GLOBAL%$pakname$	:i $FormatText$$checksumname$ = $zone_context$%s("%t")$t$ = %GLOBAL%$pakname$	:i $PushAssetContext$$context$ = %GLOBAL%$zone_context$	:i if NOT $IsAssetLoaded$$name$ = %GLOBAL%$texdict$		:i $printf$${StructString 0x00000000 = "Zone texdict not found for visualizer"}$		:i $PopAssetContext$		:i return 	:i endif	:i $found$ = %i(0)	:i $GetArraySize$%GLOBAL%$textureassets$	:i $index$ = %i(0)	:i while 	:i if $IsTextureInDictionary$$dictionary$ = %GLOBAL%$texdict$$texture$ = (%GLOBAL%$textureassets$:a{%GLOBAL%$index$:a})		:i $textureasset$ = (%GLOBAL%$textureassets$:a{%GLOBAL%$index$:a})		:i $found$ = %i(1)		:i continue	:i endif	:i $index$ = (%GLOBAL%$index$ + %i(1))	:i loop_to %GLOBAL%$array_size$	:i if (%GLOBAL%$found$ = %i(0))		:i $printf$%s("Nowhere to put visualizer in %s")$s$ = %GLOBAL%$pakname$		:i $PopAssetContext$		:i return 	:i endif	:i $PopAssetContext$	:i $change$$current_visualizer$ = ~%GLOBAL%$visualizer$	:i $change$${StructQBKey current_visualizer_2D = false}$	:i $CreateViewport$:s{		:i $priority$ = %i(20)		:i $id$ = %GLOBAL%$viewport$		:i $style$ = %GLOBAL%$style$		:i $use_lod_shader$ = $true$		:i $framerate$ = %i(60)		:i $framemask$ = %i(3)	:i :s}	:i $FormatText$$checksumname$ = $fx_func$%s("create_visualizer_fx_%s")$s$ = %GLOBAL%$pakname$	:i if $ScriptExists$%GLOBAL%$fx_func$		:i %GLOBAL%$fx_func$ isNull 	:i else 		:i $create_visualizer_fx$ isNull 	:i endif	:i $GetPakManCurrent$${StructQBKey map = zones}$	:i switch %GLOBAL%$pak$		:i case $z_Visualizer$			:i if (~$use_60fps_visualizer$ = $true$)				:i $viewport$ = $fullscreen_visualizer_viewport$			:i else 				:i $viewport$ = $bg_viewport$			:i endif			:i endcase		default 			:i $viewport$ = $visualizer_viewport$	:i end_switch	:i $setsearchallassetcontexts$	:i $CreateViewportTextureOverride$:s{		:i $id$ = %GLOBAL%$viewport$		:i $viewportid$ = %GLOBAL%$viewport$		:i $texture$ = %GLOBAL%$textureasset$		:i $texdict$ = %GLOBAL%$texdict$	:i :s}	:i $setsearchallassetcontexts$${StructQBKey Off}$	:i $create_extra_visualizers$$viewport$ = %GLOBAL%$viewport$	:i endfunction]Script Destroy_visualizer 0x2d9c9568 [	:i $printf$${StructQBStringQs ee9d3d60}$	:i if $ScreenElementExists$${StructQBKey id = fullscreen_visualizer_viewport}$		:i $DestroyScreenElement$${StructQBKey id = fullscreen_visualizer_viewport}$		:i $engineConfig$${StructInt LightVolume = 1}$	:i endif	:i $visualizer$ = ~$current_visualizer$	:i if (%GLOBAL%$visualizer$ = $None$)		:i return 	:i endif	:i if (~$current_visualizer_2D$ = $false$)		:i $AddParams$(%GLOBAL%$visualizer$)		:i $KillCamAnim$$name$ = %GLOBAL%$name$		:i $setsearchallassetcontexts$		:i $DestroyViewportTextureOverride$$id$ = %GLOBAL%$viewport$		:i $destroy_extra_visualizers$$id$ = %GLOBAL%$viewport$		:i $setsearchallassetcontexts$${StructQBKey Off}$		:i $DestroyViewport$$id$ = %GLOBAL%$viewport$	:i else 		:i $viewport$ = $bg_viewport$		:i if $ScreenFX_FXInstanceExists$$viewport$ = %GLOBAL%$viewport$$name$ = $AV_Test0$			:i $ScreenFX_ClearFXInstances$:s{$viewport$ = %GLOBAL%$viewport$:s}		:i endif	:i endif	:i $change$${StructQBKey current_visualizer = None}$	:i endfunction]SectionStruct extra_visualizer_params{	StructHeader	{		StructArray textureassets		{			ArrayQBKey			[				tex\zones\Z_visualizer\OG_visualizer.dds				tex\zones\Z_visualizer\OG_visualizer.dds			]		}		StructArray texdicts		{			ArrayQBKey			[				models\CAR_Instruments\Guitar\Schecter\gtr1_sch_tempest.tex				models\venues\egypt\skin_sarcophagus.tex			]		}	}}SectionInteger extra_visualizers 0Script create_extra_visualizers 0x44be33ad [	:i $GetArraySize$(~$extra_visualizer_params$->$textureassets$)	:i $asset_index$ = %i(0)	:i while 	:i switch %GLOBAL%$asset_index$		:i case %i(0)			:i $PushAssetContext$${StructQBKey context = heap_musician1}$			:i endcase		case %i(1)			:i $PushAssetContext$${StructQBKey context = heap_musician2}$			:i endcase		case %i(2)			:i $PushAssetContext$${StructQBKey context = heap_musician3}$			:i endcase		case %i(3)			:i $PushAssetContext$${StructQBKey context = heap_musician4}$			:i endcase		case %i(4)			:i return 	:i end_switch	:i $asset_index$ = (%GLOBAL%$asset_index$ + %i(1))	:i $index$ = %i(0)	:i while 	:i $found$ = %i(1)	:i $texdict$ = (~$extra_visualizer_params$->$texdicts$:a{%GLOBAL%$index$:a})	:i $textureasset$ = (~$extra_visualizer_params$->$textureassets$:a{%GLOBAL%$index$:a})	:i if NOT $IsAssetLoaded$$name$ = %GLOBAL%$texdict$		:i $printf$%s("texdict %s not found for visualizer (this is normal)")$s$ = %GLOBAL%$texdict$		:i $found$ = %i(0)	:i else 		:i if NOT $IsTextureInDictionary$$dictionary$ = %GLOBAL%$texdict$$texture$ = %GLOBAL%$textureasset$			:i $printf$%s("texture %s not found for visualizer (this is normal)")$s$ = %GLOBAL%$texdict$			:i $found$ = %i(0)		:i endif	:i endif	:i if (%GLOBAL%$found$ = %i(1))		:i $printf$${StructQBStringQs e77df91d}$		:i $setsearchallassetcontexts$		:i $CreateViewportTextureOverride$:s{			:i $id$ = %GLOBAL%$viewport$			:i $viewportid$ = %GLOBAL%$viewport$			:i $texture$ = %GLOBAL%$textureasset$			:i $texdict$ = %GLOBAL%$texdict$		:i :s}		:i $setsearchallassetcontexts$${StructQBKey Off}$	:i endif	:i $change$$extra_visualizers$ = (~$extra_visualizers$ + %i(1))	:i $index$ = (%GLOBAL%$index$ + %i(1))	:i loop_to %GLOBAL%$array_size$	:i $PopAssetContext$	:i loop_to 	:i endfunction]Script destroy_extra_visualizers 0x1ab18ea8 [	:i while 	:i if (~$extra_visualizers$ = %i(0))		:i continue	:i endif	:i $setsearchallassetcontexts$	:i $DestroyViewportTextureOverride$$id$ = %GLOBAL%$id$	:i $setsearchallassetcontexts$${StructQBKey Off}$	:i $change$$extra_visualizers$ = (~$extra_visualizers$ - %i(1))	:i loop_to 	:i endfunction]SectionQBKey Visualizer_Current_Bank NoneSectionInteger g_current_visualizer_intensity 1SectionArray g_current_visualizer_color{	ArrayInteger	[		0		0		0		0	]}Script Select_Visualizer_Bank a2d9ebc6 [	:i $change$${StructQBKey Visualizer_Current_Bank = None}$	:i $Playlist_GetCurrentSong$	:i $get_song_struct$$song$ = %GLOBAL%$current_song$	:i if $StructureContains$$structure$ = %GLOBAL%$song_struct$$name$ = $genre$		:i $genre$ = (%GLOBAL%$song_struct$->$genre$)	:i else 		:i $genre$ = $rock$	:i endif	:i $bank_choices$ = :a{:a}	:i $include_globals$ = $true$	:i $GetPakManCurrentName$${StructQBKey map = zones}$	:i $FormatText$$checksumname$ = $venue_banks$%s("%s_visualizer_banks")$s$ = %GLOBAL%$pakname$$addtostringlookup$ = $true$	:i if $globalexists$$name$ = %GLOBAL%$venue_banks$$type$ = $structure$		:i if $StructureContains$$structure$ = ~%GLOBAL%$venue_banks$$name$ = $include_global_banks$			:i $include_globals$ = (~%GLOBAL%$venue_banks$->$include_global_banks$)		:i endif		:i if $StructureContains$$structure$ = ~%GLOBAL%$venue_banks$$name$ = %GLOBAL%$genre$			:i $bank_array$ = (~%GLOBAL%$venue_banks$->%GLOBAL%$genre$)			:i $GetArraySize$%GLOBAL%$bank_array$			:i if (%GLOBAL%$array_size$ > %i(0))				:i $index$ = %i(0)				:i while 				:i $next_choice$ = (%GLOBAL%$bank_array$:a{%GLOBAL%$index$:a})				:i if NOT $ArrayContains$$array$ = %GLOBAL%$bank_choices$$contains$ = %GLOBAL%$next_choice$					:i $AddArrayElement$$array$ = %GLOBAL%$bank_choices$$element$ = %GLOBAL%$next_choice$					:i $bank_choices$ = %GLOBAL%$array$				:i endif				:i $index$ = (%GLOBAL%$index$ + %i(1))				:i loop_to %GLOBAL%$array_size$			:i endif		:i else 			:i $include_globals$ = $true$		:i endif	:i else 	:i endif	:i if (%GLOBAL%$include_globals$ = $true$)		:i if $globalexists$${				StructQBKey name = Global_Visualizer_Banks				StructQBKey type = structure			}$						:i if $StructureContains$$structure$ = ~$Global_Visualizer_Banks$$name$ = %GLOBAL%$genre$				:i $bank_array$ = (~$Global_Visualizer_Banks$->%GLOBAL%$genre$)			:i else 				:i $bank_array$ = (~$Global_Visualizer_Banks$->$rock$)			:i endif			:i $GetArraySize$%GLOBAL%$bank_array$			:i if (%GLOBAL%$array_size$ > %i(0))				:i $index$ = %i(0)				:i while 				:i $next_choice$ = (%GLOBAL%$bank_array$:a{%GLOBAL%$index$:a})				:i if NOT $ArrayContains$$array$ = %GLOBAL%$bank_choices$$contains$ = %GLOBAL%$next_choice$					:i $AddArrayElement$$array$ = %GLOBAL%$bank_choices$$element$ = %GLOBAL%$next_choice$					:i $bank_choices$ = %GLOBAL%$array$				:i endif				:i $index$ = (%GLOBAL%$index$ + %i(1))				:i loop_to %GLOBAL%$array_size$			:i endif		:i endif	:i else 	:i endif	:i $GetArraySize$%GLOBAL%$bank_choices$	:i if (%GLOBAL%$array_size$ > %i(0))		:i $getrandomvalue$$name$ = $index$$integer$$a$ = %i(0)$b$ = (%GLOBAL%$array_size$%i(4294967295))		:i $change$$Visualizer_Current_Bank$ = (%GLOBAL%$bank_choices$:a{%GLOBAL%$index$:a})	:i else 		:i $scriptassert$^[946656bc]^$a$ = %GLOBAL%$genre$$b$ = %GLOBAL%$pakname$	:i endif	:i endfunction]Script set_visualizer 0x870da162 [	${		StructInt intensity = 0		StructArray color		{			ArrayInteger			[				0				0				0				0			]		}		StructQBKey name = None	}$		:i if (%GLOBAL%$intensity$ !== %i(0))		:i $change$${StructQBKey Visualizer_Current_Bank = Intensity_Visualizer_Bank}$		:i $change$$g_current_visualizer_intensity$ = %GLOBAL%$intensity$	:i elseif (((%GLOBAL%$color$:a{%i(0):a}) !== %i(0)) OR ((%GLOBAL%$color$:a{%i(1):a}) !== %i(0)) OR ((%GLOBAL%$color$:a{%i(2):a}) !== %i(0)))		:i $change$${StructQBKey Visualizer_Current_Bank = ColorSwap_Visualizer_Bank}$		:i $change$$g_current_visualizer_color$ = %GLOBAL%$color$	:i elseif (%GLOBAL%$name$ !== $None$)		:i $change$$Visualizer_Current_Bank$ = %GLOBAL%$name$	:i endif	:i $LightShow_PassEvent$${StructQBKey event = visualizerChange}$	:i endfunction]SectionQBKey visualizer_Events_Enabled trueScript visualizer_event 0x89c771fb [	:i if (~$visualizer_Events_Enabled$ = $false$)		:i return 	:i endif	:i if (~$Visualizer_Current_Bank$ = $None$)		:i return 	:i endif	:i $GetPakManCurrent$${StructQBKey map = zones}$	:i switch %GLOBAL%$pak$		:i case $z_Visualizer$			:i if (~$use_60fps_visualizer$ = $true$)				:i $viewport$ = $fullscreen_visualizer_viewport$			:i else 				:i $viewport$ = $bg_viewport$			:i endif			:i endcase		default 			:i $viewport$ = $visualizer_viewport$	:i end_switch	:i if NOT $ViewportExists$$id$ = %GLOBAL%$viewport$		:i $printf$$channel$ = $visualizer$^[18bb9e0b]^$a$ = %GLOBAL%$viewport$		:i return 	:i endif	:i if NOT $globalexists$${			StructQBString name = Visualizer_Current_Bank			StructQBKey type = structure		}$				:i $printf$${			StructQBKey channel = visualizer			StructQBStringQs fe945df2			StructQBString a = Visualizer_Current_Bank		}$				:i return 	:i endif	:i $current_bank$ = ~$Visualizer_Current_Bank$	:i $i$ =  thaw_50 %vec2(-1.0,1.0)	:i while 	:i $LightShow_GetParams$	:i $prev_bank$ = %GLOBAL%$current_bank$	:i $current_bank$ = ~$Visualizer_Current_Bank$	:i if (%GLOBAL%$current_bank$ = $Intensity_Visualizer_Bank$)		:i $base$ = $intensity$		:i $FormatText$${			StructQBKey textname = intensity_num			StructString 0x00000000 = "%i"			StructQBString i = g_current_visualizer_intensity		}$				:i $AppendSuffixToChecksum$$base$ = %GLOBAL%$base$$suffixstring$ = %GLOBAL%$intensity_num$		:i %GLOBAL%$av_presets$ = (~%GLOBAL%$current_bank$->%GLOBAL%$appended_id$)	:i elseif (%GLOBAL%$current_bank$ = $ColorSwap_Visualizer_Bank$)		:i %GLOBAL%$struct$ = ((~%GLOBAL%$current_bank$->$default$):a{%i(0):a})		:i %GLOBAL%$prims$ = (%GLOBAL%$struct$->$primitives$)		:i %GLOBAL%$prim$ = (%GLOBAL%$prims$:a{%i(0):a})		:i %GLOBAL%$prim$ = :s{%GLOBAL%$prim$$color$ = ~$g_current_visualizer_color$:s}		:i $SetArrayElement$$arrayName$ = $prims$$index$ = %i(0)$newValue$ = %GLOBAL%$prim$		:i %GLOBAL%$struct$ = :s{%GLOBAL%$struct$$primitives$ = %GLOBAL%$prims$:s}		:i %GLOBAL%$av_presets$ = :a{:a}		:i $AddArrayElement$$array$ = %GLOBAL%$av_presets$$element$ = %GLOBAL%$struct$		:i %GLOBAL%$av_presets$ = %GLOBAL%$array$	:i else 		:i %GLOBAL%$av_presets$ = (~%GLOBAL%$current_bank$->%GLOBAL%$mood$)	:i endif	:i if NOT $GotParam$${StructQBKey av_presets}$		:i $printf$^[c93be3cb]^$a$ = %GLOBAL%$mood$$b$ = ~$Visualizer_Current_Bank$$DoNoResolve$		:i continue	:i endif	:i $GetArraySize$%GLOBAL%$av_presets$	:i if (%GLOBAL%$current_bank$ !== %GLOBAL%$prev_bank$)		:i %GLOBAL%$i$ =  thaw_50 %vec2(-1.0,1.0)	:i endif	:i %GLOBAL%$i$ = (%GLOBAL%$i$ + %i(1))	:i if (%GLOBAL%$i$ >= %GLOBAL%$array_size$)		:i %GLOBAL%$i$ = %i(0)	:i endif	:i if $IsArray$(%GLOBAL%$av_presets$:a{%GLOBAL%$i$:a})		:i $create_avfx$:s{$primitives$ = (%GLOBAL%$av_presets$:a{%GLOBAL%$i$:a})$viewport$ = %GLOBAL%$viewport$:s}	:i else 		:i $create_avfx$:s{$profile$ = (%GLOBAL%$av_presets$:a{%GLOBAL%$i$:a})$viewport$ = %GLOBAL%$viewport$:s}	:i endif	:i $LightShow_WaitForNextEvent$${		StructArray events		{			ArrayQBKey			[				snapshotchange				visualizerChange			]		}	}$		:i $LightShow_ProcessNoteLength$$Length$ = %GLOBAL%$Length$	:i $RemoveParameter$${StructQBKey av_presets}$	:i loop_to 	:i endfunction]SectionQBKey current_bandname_viewport NoneSectionStruct bandname_viewport_params{	StructHeader	{		StructQBKey viewport = bandname_viewport		StructQBKey textureasset = tex\zones\Z_Band_Logo\RMM_band_name.dds		StructArray texdicts		{			ArrayString			[				"zones/%s/%t.tex"				"models/venues/recordstore/encore_bandart_skin.tex"				"models/venues/recordstore/encore_record_skin.tex"			]		}		StructQBKey style = bandname_rendering		StructQBKey name = bandname_cam		StructQBKey window_id = bandname_window	}}SectionStruct default_bandname_settings{	StructHeader	{		StructQBKey font = fontgrid_text_a1		StructArray just		{			ArrayQBKey			[				center				center			]		}		StructArray internal_just		{			ArrayQBKey			[				center				center			]		}		StructArray rgba		{			ArrayInteger			[				210				210				210				255			]		}		StructInt alpha = 1		StructQBKey fit_width = scale each line if larger		StructQBKey fit_height = scale to fit		StructQBKey scale_mode = proportional	}}Script get_bandname_viewport_text ffffffff [	:i endfunction]Script create_bandname_viewport ffffffff [	:i endfunction]Script bandname_viewport_disabler ffffffff [	:i endfunction]Script destroy_bandname_viewport ffffffff [	:i endfunction]Script PauseFullScreenMovie b4bd4100 [	:i if $IsMoviePlaying$${StructInt textureslot = 0}$		:i $PauseMovie$${StructInt textureslot = 0}$	:i endif	:i endfunction]Script UnPauseFullScreenMovie dfa610fb [	:i if $IsMoviePlaying$${StructInt textureslot = 0}$		:i $ResumeMovie$${StructInt textureslot = 0}$	:i endif	:i endfunction]Script PlayMovieAndWait 0x940a775b [	${		Unknown [00012700e2a10d906969696900000018]		StructInt hide_glitch_frames = 0	}$		:i $audio_ui_menu_music_off$	:i if $notcd$		:i if (~$show_movies$ = %i(0))			:i return 		:i endif	:i endif	:i $setscriptcannotpause$	:i $PushUnsafeForShutdown$${		StructQBKey context = movie		StructQBKey type = checked	}$		:i if NOT $GotParam$${StructQBKey noblack}$		:i $fadetoblack$${			StructQBKey on			StructInt time = 0			StructFloat alpha = 1.00			StructInt z_priority = -10		}$			:i endif	:i $KillAllMovies$	:i $destroy_bink_sub_heaps$	:i $printf$^[23871deb]^$s$ = %GLOBAL%$movie$	:i $PlayMovie$:s{		:i $textureslot$ = %i(0)		:i $texturepri$ = %i(1000)		:i $no_looping$		:i $no_hold$		:i isNull 	:i :s}	:i if $GotParam$${StructQBKey noskip}$		:i $event_handlers$ = :a{:a}	:i else 		:i if $InNetGame$			:i $event_handlers$ = :a{				:i :s{$pad_start$$NetEndMovie$:s}				:i :s{$pad_choose$$NetEndMovie$:s}			:i :a}		:i else 			:i $event_handlers$ = :a{				:i :s{$pad_start$$EndMovie$$params$ = :s{$play_back_sfx$ = %i(1):s}:s}				:i :s{$pad_choose$$EndMovie$:s}			:i :a}		:i endif	:i endif	:i $CreateScreenElement$:s{		:i $type$ = $ContainerElement$		:i $parent$ = $root_window$		:i $id$ = $movie_handler$		:i $event_handlers$ = %GLOBAL%$event_handlers$	:i :s}	:i $LaunchEvent$${		StructQBKey type = focus		StructQBKey target = movie_handler	}$		:i if NOT $GotParam$${StructQBKey no_script_wait}$		:i $WaitForMovie$$movie$ = %GLOBAL%$movie$$hide_glitch_frames$ = %GLOBAL%$hide_glitch_frames$	:i endif	:i endfunction]Script WaitForMovie 0x946aa485 [	${		Unknown [00012700e2a10d906969696900000018]		StructInt hide_glitch_frames = 0	}$		:i $setscriptcannotpause$	:i while 	:i if $IsMovieUnloaded$${StructInt textureslot = 0}$		:i continue	:i endif	:i if (~$paused_for_hardware$ = %i(1))		:i continue	:i endif	:i $wait$${		StructInt 1		StructQBKey gameframes	}$		:i loop_to 	:i if (%GLOBAL%$hide_glitch_frames$ > %i(0))		:i $hide_glitch$$num_frames$ = %GLOBAL%$hide_glitch_frames$	:i endif	:i $EndMovie$	:i while 	:i if NOT $ScreenElementExists$${StructQBKey id = movie_handler}$		:i continue	:i endif	:i $wait$${		StructInt 1		StructQBKey gameframe	}$		:i loop_to 	:i if NOT $GotParam$${StructQBKey noblack}$		:i $printf$^[27e8073d]^$s$ = %GLOBAL%$movie$		:i $fadetoblack$${			StructQBKey Off			StructInt time = 0		}$			:i endif	:i $PopUnsafeForShutdown$${		StructQBKey context = movie		StructQBKey type = checked	}$		:i endfunction]Script WaitForMovie_EndCredits 0x924a5a9f [	:i while 	:i if $IsMovieUnloaded$${StructInt textureslot = 0}$		:i continue	:i endif	:i if (~$paused_for_hardware$ = %i(1))		:i $PauseFullScreenMovie$		:i while 		:i if (~$paused_for_hardware$ = %i(0))			:i $UnPauseFullScreenMovie$			:i continue		:i endif		:i $wait$${			StructInt 1			StructQBKey gameframes		}$				:i loop_to 	:i endif	:i $wait$${		StructInt 1		StructQBKey gameframes	}$		:i loop_to 	:i $EndMovie$	:i while 	:i if NOT $ScreenElementExists$${StructQBKey id = movie_handler}$		:i continue	:i endif	:i $wait$${		StructInt 1		StructQBKey gameframe	}$		:i loop_to 	:i $audio_ui_menu_music_on$	:i if NOT $GotParam$${StructQBKey noblack}$		:i $printf$^[27e8073d]^$s$ = %GLOBAL%$movie$		:i $fadetoblack$${			StructQBKey Off			StructInt time = 0		}$			:i endif	:i $PopUnsafeForShutdown$${		StructQBKey context = movie		StructQBKey type = checked	}$		:i endfunction]Script NetEndMovie 0x8dfc3cae [	:i if $InNetGame$		:i if $ishost$			:i $SendStructure$${				StructQBKey callback = EndMovie				StructStruct data_to_send				{					StructHeader					{						StructQBKey None					}				}			}$						:i $EndMovie$		:i endif	:i endif	:i endfunction]Script EndMovie e180d00e [	${		StructInt slot = 0		StructInt play_back_sfx = 0	}$		:i $SetSpawnInstanceLimits$${		StructInt max = 1		StructQBKey management = ignore_spawn_request	}$		:i if $ScreenElementExists$${StructQBKey id = movie_handler}$		:i $LaunchEvent$${			StructQBKey type = unfocus			StructQBKey target = movie_handler		}$			:i endif	:i $finalprintf$${StructString 0x00000000 = "EndMovie called"}$	:i if $IsMoviePlaying$$textureslot$ = %GLOBAL%$slot$		:i if (%GLOBAL%$play_back_sfx$ = %i(1))			:i $UI_SFX$${				StructQBKey menustate = generic				StructQBKey uitype = back			}$					:i endif		:i $finalprintf$${StructString 0x00000000 = "EndMovie calling KillMovie"}$		:i $KillMovie$$textureslot$ = %GLOBAL%$slot$ isNull 		:i $finalprintf$${StructString 0x00000000 = "EndMovie done KillMovie"}$	:i endif	:i if $GotParam$${StructQBKey nowait}$		:i $BlockForAllMovieUnloads$	:i endif	:i $finalprintf$${StructString 0x00000000 = "create_bink_sub_heaps calling"}$	:i $create_bink_sub_heaps$	:i $finalprintf$${StructString 0x00000000 = "create_bink_sub_heaps called"}$	:i if $ScreenElementExists$${StructQBKey id = movie_handler}$		:i $movie_handler$.$Die$	:i endif	:i endfunction]Script maybe_create_ui_visualizer bbabcdf7 [	${StructQBKey preset = nullchecksum}$	:i if (%GLOBAL%$preset$ !== $nullchecksum$)		:i if (%GLOBAL%$preset$ !== ~$g_current_ui_visualizer$)			:i $clear_ui_visualizer$			:i $create_ui_visualizer$$preset$ = %GLOBAL%$preset$		:i else 		:i endif	:i else 		:i if (~$game_mode$ !== $tutorial$)			:i $clear_ui_visualizer$		:i else 		:i endif	:i endif	:i endfunction]Script create_ui_visualizer 0x6651b94d [	$preset$ = (~$default_ui_visualizer_preset$)	:i $create_ui_visualizer_viewport$${		StructQBKey visualizer = ui_visualizer_viewport_params		StructQBKey viewport = ui_visualizer_viewport	}$		:i $spawnscriptnow$$create_ui_visualizer_fx$$params$ = :s{$preset$ = (~%GLOBAL%$preset$):s}	:i $change$$g_current_ui_visualizer$ = %GLOBAL%$preset$	:i endfunction]SectionStruct ui_visualizer_viewport_params{	StructHeader	{		StructArray textureassets		{			ArrayQBKey			[				ui_visualizer			]		}		StructQBKey style = ui_visualizer_rendering		StructQBKey effectname = ui_visualizer_screeneffect		StructQBKey viewport = ui_visualizer_viewport	}}Script create_ui_visualizer_viewport 0x99ec3a09 [	:i if NOT $globalexists$$name$ = %GLOBAL%$visualizer$		:i return 	:i endif	:i $AddParams$(~%GLOBAL%$visualizer$)	:i if $ScreenElementExists$$id$ = %GLOBAL%$viewport$		:i return 	:i endif	:i if $ViewportExists$$id$ = %GLOBAL%$viewport$		:i return 	:i endif	:i $textureasset$ = (%GLOBAL%$textureassets$:a{%i(0):a})	:i $CreateViewport$:s{		:i $priority$ = %i(20)		:i $id$ = %GLOBAL%$viewport$		:i $style$ = %GLOBAL%$style$		:i $use_lod_shader$ = $true$		:i $framerate$ = %i(60)		:i $framemask$ = %i(3)	:i :s}	:i $setsearchallassetcontexts$	:i if NOT $CreateViewportTextureOverride$:s{			:i $id$ = %GLOBAL%$viewport$			:i $viewportid$ = %GLOBAL%$viewport$			:i $texture$ = %GLOBAL%$textureasset$		:i :s}		:i $scriptassert$%s("CreateViewportTextureOverride failed on %a %b")$a$ = %GLOBAL%$viewport$$b$ = %GLOBAL%$textureasset$	:i endif	:i $setsearchallassetcontexts$${StructQBKey Off}$	:i $SetViewportProperties$${		StructQBKey viewport = ui_visualizer_viewport		StructQBKey active = false	}$		:i return $textureasset$ = %GLOBAL%$textureasset$	:i endfunction]Script create_ui_visualizer_fx 0x69090e09 [	:i $RequireParams$${		StructArray 0x00000000		{			ArrayQBKey			[				preset			]		}		StructQBKey all	}$		:i $AddParams$(~$ui_visualizer_viewport_params$)	:i $clear_ui_visualizer$$viewport$ = %GLOBAL%$viewport$	:i $enable_ui_visualizer$	:i if $IsArray$%GLOBAL%$preset$		:i $Create_AVUI_FX$$primitives$ = %GLOBAL%$preset$$viewport$ = %GLOBAL%$viewport$$id$ = %GLOBAL%$effectname$	:i else 		:i $Create_AVUI_FX$$profile$ = %GLOBAL%$preset$$viewport$ = %GLOBAL%$viewport$$id$ = %GLOBAL%$effectname$	:i endif	:i endfunction]Script enable_ui_visualizer d98d8a7a [	:i if $ViewportExists$${StructQBKey id = ui_visualizer_viewport}$		:i $SetViewportProperties$${			StructQBKey viewport = ui_visualizer_viewport			StructQBKey active = true		}$			:i endif	:i endfunction]Script disable_ui_visualizer ec419388 [	:i if $ViewportExists$${StructQBKey id = ui_visualizer_viewport}$		:i $SetViewportProperties$${			StructQBKey viewport = ui_visualizer_viewport			StructQBKey active = false		}$			:i endif	:i endfunction]Script destroy_ui_visualizer a8c0f320 [	:i if $ScreenElementExists$${StructQBKey id = ui_vis_test_anchor}$		:i $DestroyScreenElement$${StructQBKey id = ui_vis_test_anchor}$	:i endif	:i if $ScreenElementExists$${StructQBKey id = ui_vis_test}$		:i $DestroyScreenElement$${StructQBKey id = ui_vis_test}$	:i endif	:i $change$${StructQBKey g_current_ui_visualizer = None}$	:i endfunction]Script clear_ui_visualizer f1f1fc58 [	:i $disable_ui_visualizer$	:i $AddParams$(~$ui_visualizer_viewport_params$)	:i if $ViewportExists$$id$ = %GLOBAL%$viewport$		:i $ScreenFX_ClearFXInstances$$viewport$ = %GLOBAL%$viewport$	:i endif	:i $change$${StructQBKey g_current_ui_visualizer = None}$	:i endfunction]