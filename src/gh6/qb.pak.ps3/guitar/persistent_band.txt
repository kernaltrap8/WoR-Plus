Unknown [1c00000000000000000047a40000000000000000]Script get_persistent_band_savegame 0x9b1877c5 [	:i $controller$ = (~$primary_controller$)	:i if (~$primary_controller$ = %i(4294967295))		:i $controller$ = %i(0)	:i endif	:i $get_savegame_from_controller$$controller$ = %GLOBAL%$controller$	:i return $savegame$ = %GLOBAL%$savegame$	:i endfunction]Script persistent_band_create_band 0x4bf42a52 [	${StructInt async = 0}$	:i $set_parts_with_mic$	:i $get_persistent_band_savegame$	:i $CasCancelLoading$	:i $CasBlockForComposite$	:i $CasBlockForLoading$	:i if $GotParam$${StructQBKey startup}$		:i $persistent_band_place_primary_character_on_part$$savegame$ = %GLOBAL%$savegame$$player$ = %i(1)		:i $i$ = %i(0)		:i while 		:i $player$ = (~$g_persistent_band_data$:a{%GLOBAL%$i$:a}->$player$)		:i if (%GLOBAL%$player$ < %i(0))			:i %GLOBAL%$player$ = (%GLOBAL%$i$ + %i(1))		:i endif		:i $getplayerinfo$%GLOBAL%$player$$part$		:i $getplayerinfo$%GLOBAL%$player$$has_mic$		:i $i$ = (%GLOBAL%$i$ + %i(1))		:i loop_to %i(4)		:i $copy_parts_to_stored_parts$	:i endif	:i $i$ = %i(0)	:i while 	:i $player$ = (~$g_persistent_band_data$:a{%GLOBAL%$i$:a}->$player$)	:i if (%GLOBAL%$player$ < %i(0))		:i %GLOBAL%$player$ = (%GLOBAL%$i$ + %i(1))	:i endif	:i $getplayerinfo$%GLOBAL%$player$$part$	:i $persistent_band_create_character$:s{		:i $async$ = %GLOBAL%$async$		:i $index$ = %GLOBAL%$i$		:i $part$ = %GLOBAL%$part$		:i $savegame$ = %GLOBAL%$savegame$		:i $player$ = %GLOBAL%$player$		:i $startup$ = %GLOBAL%$startup$		:i $refresh$ = %GLOBAL%$refresh$		:i $has_mic$ = %GLOBAL%$has_mic$	:i :s}	:i $i$ = (%GLOBAL%$i$ + %i(1))	:i if (%GLOBAL%$async$ = %i(1))		:i $wait$${			StructInt 1			StructQBKey gameframe		}$			:i endif	:i loop_to %i(4)	:i $change$${StructInt g_persistent_band_initialized = 1}$	:i endfunction]Script persistent_band_create_character bd252505 [	${Unknown [0001240090e07c796969696900000018000124007f8c98fe6969696900000000]}$	:i $FormatText$$checksumname$ = $name$%s("musician%i")$i$ = (%GLOBAL%$index$ + %i(1))	:i $FormatText$$checksumname$ = $heap$%s("heap_musician%i")$i$ = (%GLOBAL%$index$ + %i(1))	:i if NOT $GotParam$${StructQBKey refresh}$		:i if $CompositeObjectExists$$name$ = %GLOBAL%$name$			:i $destroy_band_member$$name$ = %GLOBAL%$name$		:i endif	:i endif	:i if NOT $GotParam$${StructQBKey character_id}$		:i $RequireParams$${			StructArray 0x00000000			{				ArrayQBKey				[					savegame					index				]			}			StructQBKey all		}$				:i $get_saved_band_member$$savegame$ = %GLOBAL%$savegame$$index$ = %GLOBAL%$index$	:i endif	:i $persistent_band_maybe_use_worst_case_character$	:i if NOT $GotParam$${StructQBKey override}$		:i $RequireParams$${			StructArray 0x00000000			{				ArrayQBKey				[					character_id					character_savegame				]			}			StructQBKey all		}$			:i endif	:i if $CharacterProfileGetStruct$$name$ = %GLOBAL%$character_id$$savegame$ = %GLOBAL%$character_savegame$		:i if $GotParam$${StructQBKey startup}$			:i $SetPlayerInfo$%GLOBAL%$player$$band_member$ = %GLOBAL%$name$			:i $SetPlayerInfo$%GLOBAL%$player$$character_id$ = %GLOBAL%$character_id$			:i $SetPlayerInfo$%GLOBAL%$player$$character_savegame$ = %GLOBAL%$character_savegame$			:i $SetPlayerInfo$%GLOBAL%$player$$stored_character_index$ = %GLOBAL%$index$			:i if (%GLOBAL%$player$ = %i(1))				:i $persistent_band_get_correct_vocals_character$$startup$ = %i(1)$player$ = %GLOBAL%$player$			:i endif		:i else 			:i if $GotParam$${StructQBKey refresh}$				:i $persistent_band_refresh_character$:s{					:i $index$ = %GLOBAL%$index$					:i $player$ = %GLOBAL%$player$					:i $override$ = %GLOBAL%$override$				:i :s}				:i return 			:i endif			:i $persistent_band_set_data$$index$ = %GLOBAL%$index$$building$ = %i(1)			:i $create_band_member$:s{				:i $name$ = %GLOBAL%$name$				:i $id$ = %GLOBAL%$character_id$				:i $player$ = %GLOBAL%$player$				:i $async$ = %GLOBAL%$async$				:i $asset_heap$ = %GLOBAL%$heap$				:i $savegame$ = %GLOBAL%$character_savegame$				:i $Instrument$ = %GLOBAL%$part$				:i $stored_character_index$ = %GLOBAL%$stored_character_index$				:i $with_mic$ = %GLOBAL%$has_mic$			:i :s}			:i %GLOBAL%$name$.$Pause$			:i $SetArrayElement$$arrayName$ = $cas_queue_player_info$$globalarray$$index$ = %GLOBAL%$index$$newValue$ = :s{				:i $player$ = %GLOBAL%$player$				:i $object$ = %GLOBAL%$name$			:i :s}		:i endif	:i else 		:i $scriptassert$%s("Character profile %p not found in savegame %s")$p$ = %GLOBAL%$character_id$$s$ = %GLOBAL%$character_savegame$	:i endif	:i endfunction]Script persistent_band_place_primary_character_on_part 0x0e6926ae [	:i $RequireParams$${		StructArray 0x00000000		{			ArrayQBKey			[				player				savegame			]		}		StructQBKey all	}$		:i if (~$autolaunch_go$ = %i(0))		:i return 	:i endif	:i if $IsXenonOrWinDX$		:i $controller$ = %GLOBAL%$savegame$	:i else 		:i $GetActiveControllers$		:i $GetArraySize$%GLOBAL%$active_controllers$		:i $i$ = %i(0)		:i $controller$ = %i(4294967295)		:i while 		:i if (%GLOBAL%$active_controllers$:a{%GLOBAL%$i$:a} = %i(1))			:i %GLOBAL%$controller$ = %GLOBAL%$i$			:i continue		:i endif		:i %GLOBAL%$i$ = (%GLOBAL%$i$ + %i(1))		:i loop_to %GLOBAL%$array_size$	:i endif	:i if (%GLOBAL%$controller$ >= %i(0))		:i if $IsGuitarController$$controller$ = %GLOBAL%$controller$			:i $get_progression_instrument_user_option$$controller$ = %GLOBAL%$controller$$option$ = %s("guitar_bass_flip")			:i switch (%GLOBAL%$user_option$)				:i case $None$					:i endcase				case $guitar$					:i $my_part$ = $guitar$					:i endcase				case $Bass$					:i $my_part$ = $Bass$					:i endcase				default 					:i $my_part$ = $guitar$			:i end_switch		:i elseif $IsDrumController$$controller$ = %GLOBAL%$controller$			:i $my_part$ = $drum$		:i elseif $is_regular_controller$$controller$ = %GLOBAL%$controller$			:i $my_part$ = $Vocals$		:i else 			:i $my_part$ = $Vocals$		:i endif		:i $getplayerinfo$%GLOBAL%$player$$part$$out$ = $this_part$		:i if (%GLOBAL%$this_part$ !== %GLOBAL%$my_part$)			:i $next_player$ = (%GLOBAL%$player$ + %i(1))			:i while 			:i if (%GLOBAL%$next_player$ > %i(4))				:i continue			:i endif			:i $getplayerinfo$%GLOBAL%$player$$part$$out$ = $this_part$			:i $getplayerinfo$%GLOBAL%$next_player$$part$$out$ = $next_part$			:i $SetPlayerInfo$%GLOBAL%$player$$part$ = %GLOBAL%$next_part$			:i $SetPlayerInfo$%GLOBAL%$next_player$$part$ = %GLOBAL%$this_part$			:i if (%GLOBAL%$next_part$ = %GLOBAL%$my_part$)				:i continue			:i else 				:i $next_player$ = (%GLOBAL%$next_player$ + %i(1))			:i endif			:i loop_to 		:i endif	:i endif	:i endfunction]Script persistent_band_setup_new_character edca33db [	:i $RequireParams$${		StructArray 0x00000000		{			ArrayQBKey			[				name				Instrument				player			]		}		StructQBKey all	}$		:i if (%GLOBAL%$Instrument$ = $None$)		:i return 	:i endif	:i if NOT $ObjectExists$$id$ = %GLOBAL%$name$		:i $printf$^[adf70858]^$i$ = %GLOBAL%$name$$channel$ = $persistent_band$		:i return 	:i endif	:i if (~$is_in_cas$ = %i(0))		:i %GLOBAL%$name$.$persistent_band_play_default_anim$	:i endif	:i if (%GLOBAL%$Instrument$ !== $Vocals$)		:i %GLOBAL%$name$.$hide_mic$	:i endif	:i $band_lobby_get_player_submenu_index$$player_num$ = %GLOBAL%$player$	:i if (%i(4294967295) !== %GLOBAL%$submenu_index$)		:i $band_lobby_play_viewport_camera$:s{			:i $viewport_index$ = %GLOBAL%$submenu_index$			:i $lock_to_target$ = %GLOBAL%$name$			:i $fix_camera_shudder$ = %i(1)		:i :s}	:i endif	:i endfunction]Script persistent_band_get_alias_from_part b190ebb5 [	:i $RequireParams$${		StructArray 0x00000000		{			ArrayQBKey			[				part			]		}		StructQBKey all	}$		:i switch %GLOBAL%$part$		:i case $guitar$			:i endcase		case $guitar_and_vocals$			:i $alias$ = $guitarist$			:i endcase		case $Vocals$			:i endcase		case $vocals_and_guitar$			:i $alias$ = $vocalist$			:i endcase		case $drum$			:i $alias$ = $drummer$			:i endcase		case $Bass$			:i $alias$ = $bassist$			:i endcase		default 			:i $scriptassert$^[a3aa9fb5]^$p$ = %GLOBAL%$part$	:i end_switch	:i if $ObjectExists$$id$ = %GLOBAL%$alias$		:i %GLOBAL%$alias$.$obj_getid$		:i $printf$%s("alias %a is already in use by %o")$xchannel$ = $persistent_band$$a$ = %GLOBAL%$alias$$o$ = %GLOBAL%$ObjID$		:i $persistent_band_get_unused_alias$	:i endif	:i return $alias$ = %GLOBAL%$alias$	:i endfunction]Script persistent_band_get_unused_alias 0x162eb50b [	:i $guitarists$ = %i(0)	:i $vocalists$ = %i(0)	:i $bassists$ = %i(0)	:i $drummers$ = %i(0)	:i $get_player_infos_in_use$	:i $i$ = %i(0)	:i while 	:i $player$ = (%GLOBAL%$player_infos_in_use$:a{%GLOBAL%$i$:a})	:i $persistent_band_get_index_from_player$$player$ = %GLOBAL%$player$	:i $part$ = (~$g_persistent_band_data$:a{%GLOBAL%$index$:a}->$Instrument$)	:i switch %GLOBAL%$part$		:i case $guitar$			:i $guitarists$ = (%GLOBAL%$guitarists$ + %i(1))			:i endcase		case $Vocals$			:i $vocalists$ = (%GLOBAL%$vocalists$ + %i(1))			:i endcase		case $Bass$			:i $bassists$ = (%GLOBAL%$bassists$ + %i(1))			:i endcase		case $drum$			:i $drummers$ = (%GLOBAL%$drummers$ + %i(1))			:i endcase		default 			:i $scriptassert$%s("persistent_band_get_unused_alias has unknown part %p")$p$ = %GLOBAL%$part$	:i end_switch	:i $i$ = (%GLOBAL%$i$ + %i(1))	:i loop_to %i(4)	:i if (%GLOBAL%$guitarists$ = %i(0))		:i if NOT $ObjectExists$${StructQBKey id = guitarist}$			:i return ${StructQBKey alias = guitarist}$		:i endif	:i endif	:i if (%GLOBAL%$bassists$ = %i(0))		:i if NOT $ObjectExists$${StructQBKey id = bassist}$			:i return ${StructQBKey alias = bassist}$		:i endif	:i endif	:i if (%GLOBAL%$vocalists$ = %i(0))		:i if NOT $ObjectExists$${StructQBKey id = vocalist}$			:i return ${StructQBKey alias = vocalist}$		:i endif	:i endif	:i if (%GLOBAL%$drummers$ = %i(0))		:i if NOT $ObjectExists$${StructQBKey id = drummer}$			:i return ${StructQBKey alias = drummer}$		:i endif	:i endif	:i $persistent_band_print_info$	:i $printstruct$(~$g_current_band$)	:i $scriptassert$${StructQBStringQs 0x8a111b79}$	:i endfunction]Script persistent_band_prepare_for_song edf13059 [	${StructInt async = 0}$	:i $KillSpawnedScript$${StructQBKey name = persistent_band_cancel_lobby}$	:i $printscriptinfo$${StructString 0x00000000 = "persistent_band_prepare_for_song"}$	:i $OnExitRun$${StructQBKey persistent_band_prepare_for_song_exit}$	:i $change$${StructInt g_suppress_menu_stack_loop_check = 1}$	:i $Playlist_GetCurrentSong$	:i $get_persistent_band_savegame$	:i $set_parts_with_mic$ isNull 	:i $should_use_alt_positions$	:i $persistent_band_unique_musician_check$	:i $celeb_band$ = %i(0)	:i $change$${StructQBKey g_current_band = default_band}$	:i if NOT $GotParam$${StructQBKey startup}$		:i if NOT $change_band_for_song$			:i $gamemode_gettype$			:i if (%GLOBAL%$type$ = $freeplay$ OR ~$in_sing_a_long$ = $true$)				:i $get_player_infos_in_use$				:i $i$ = %i(0)				:i while 				:i $persistent_band_get_correct_vocals_character$$player$ = (%GLOBAL%$player_infos_in_use$:a{%GLOBAL%$i$:a})				:i $i$ = (%GLOBAL%$i$ + %i(1))				:i loop_to %i(4)			:i else 				:i $persistent_band_refresh_changed_characters$$async$ = %GLOBAL%$async$			:i endif		:i else 			:i $celeb_band$ = %i(1)		:i endif	:i endif	:i $cas_queue_wait$	:i while 	:i if $persistent_band_finished_building$		:i continue	:i endif	:i $wait$${		StructInt 1		StructQBKey gameframe	}$		:i loop_to 	:i $persistent_band_pause_all_characters$	:i if NOT $persistent_band_has_four_musicians$		:i $persistent_band_print_info$${StructQBKey channel = main}$		:i $scriptassert$${StructQBStringQs d93a2b88}$	:i endif	:i $persistent_band_update_all_aliases$	:i $pick_random_win_lose_anims$ isNull 	:i if NOT $quest_progression_is_chapter_rush$		:i $BandManager_AirGuitarCheat$	:i endif	:i $Band_ClearAnimTempo$	:i $prepare_for_pending_animpaks$	:i if (%GLOBAL%$async$ = %i(1))		:i $wait$${			StructInt 1			StructQBKey gameframe		}$			:i endif	:i $AnimLoadBeginRequests$${		StructQBKey group = loop_anims		StructQBKey heap = heap_musician_anim		StructQBKey slop_heap = heap_musician_anim		StructQBKey asset_context = loop_anims	}$		:i $AnimLoadBeginRequests$${		StructQBKey group = win_lose_anims		StructQBKey heap = heap_win_lose_anim		StructQBKey slop_heap = heap_win_lose_anim		StructQBKey asset_context = win_lose_anims	}$		:i $i$ = %i(0)	:i while 	:i $FormatText$$checksumname$ = $name$%s("musician%i")$i$ = (%GLOBAL%$i$ + %i(1))	:i $part$ = (~$g_persistent_band_data$:a{%GLOBAL%$i$:a}->$Instrument$)	:i $persistent_band_move_and_orient_band_member$$name$ = %GLOBAL%$name$	:i if (~$g_current_band$ !== $default_band$)		:i $persistent_band_get_celeb_part_from_character_id$:s{			:i $character_id$ = (~$g_persistent_band_data$:a{%GLOBAL%$i$:a}->$character_id$)		:i :s}		:i $position_part$ = %GLOBAL%$celeb_part$	:i else 		:i $position_part$ = %GLOBAL%$part$	:i endif	:i if (~$cheat_airinstruments$ = %i(0))		:i if (%GLOBAL%$position_part$ !== $Vocals$)			:i %GLOBAL%$name$.$hide_mic$		:i else 			:i %GLOBAL%$name$.$show_mic$		:i endif	:i endif	:i %GLOBAL%$stored_character_index$ = (~$g_persistent_band_data$:a{%GLOBAL%$i$:a}->$stored_character_index$)	:i $get_saved_band_member$$savegame$ = %GLOBAL%$savegame$$index$ = %GLOBAL%$stored_character_index$	:i $band_load_single_anim_pak$:s{		:i $character_id$ = %GLOBAL%$character_id$		:i $part$ = %GLOBAL%$part$		:i $name$ = %GLOBAL%$name$		:i $savegame$ = %GLOBAL%$character_savegame$		:i $async$ = %GLOBAL%$async$		:i $player$ = %GLOBAL%$player$		:i $song$ = %GLOBAL%$current_song$		:i $slot_index$ = %GLOBAL%$iSlotIndex$	:i :s}	:i $band_member_start_anims$:s{		:i $name$ = %GLOBAL%$name$		:i $Instrument$ = %GLOBAL%$part$		:i $loading_into_song$ = %GLOBAL%$current_song$		:i $async$ = %GLOBAL%$async$	:i :s}	:i %GLOBAL%$name$.$anim_command$:s{		:i $target$ = $moment_blend$		:i $command$ = $partialswitch_setstate$		:i $params$ = :s{			:i $Off$			:i $blendduration$ = %f(0.0)		:i :s}	:i :s}	:i if (%GLOBAL%$async$ = %i(1))		:i $wait$${			StructInt 1			StructQBKey gameframe		}$			:i endif	:i $i$ = (%GLOBAL%$i$ + %i(1))	:i loop_to %i(4)	:i $AnimLoadEndRequestsAndDoLoading$${StructQBKey group = loop_anims}$	:i $AnimLoadEndRequestsAndDoLoading$${StructQBKey group = win_lose_anims}$	:i $printf$${StructString 0x00000000 = "Began loading loop anims..."}$	:i $ArchiveWaitLoading$:s{		:i $loop_anims$		:i $async$ = %GLOBAL%$async$	:i :s}	:i $ArchiveWaitLoading$:s{		:i $win_lose_anims$		:i $async$ = %GLOBAL%$async$	:i :s}	:i $printf$${StructString 0x00000000 = "Finished loading loop anims!"}$	:i $persistent_band_pause_all_characters$${StructQBKey UnPause}$	:i if $ScriptExists$${StructQBKey z_credits_lock_band_to_ampzilla}$		:i $z_credits_lock_band_to_ampzilla$	:i endif	:i endfunction]Script persistent_band_prepare_for_song_exit 0x4b8afdd9 [	:i $change$${StructInt g_suppress_menu_stack_loop_check = 0}$	:i endfunction]Script persistent_band_change_rocker 0x551eba7e [	${		StructInt use_power_rocker = 0		StructInt transformation = 0	}$		:i $change_band_for_song$:s{$use_power_rocker$ = %GLOBAL%$use_power_rocker$$transformation$ = %GLOBAL%$transformation$:s}	:i while 	:i if $persistent_band_finished_building$		:i continue	:i endif	:i $wait$${		StructInt 1		StructQBKey gameframe	}$		:i loop_to 	:i if NOT $persistent_band_has_four_musicians$		:i $persistent_band_print_info$${StructQBKey channel = main}$		:i $scriptassert$${StructQBStringQs d93a2b88}$	:i endif	:i $persistent_band_update_all_aliases$	:i endfunction]Script persistent_band_cancel_lobby 0x11c16947 [	:i $printf$${		StructString 0x00000000 = "persistent_band_cancel_lobby"		StructQBKey channel = persistent_band	}$		:i $persistent_band_unique_musician_check$	:i $persistent_band_force_traditional_band$	:i while 	:i if $persistent_band_finished_building$		:i continue	:i endif	:i $wait$${		StructInt 1		StructQBKey gameframe	}$		:i loop_to 	:i if NOT $persistent_band_has_four_musicians$		:i return 	:i endif	:i $persistent_band_update_all_aliases$	:i $i$ = %i(0)	:i while 	:i $FormatText$$checksumname$ = $name$%s("musician%i")$i$ = (%GLOBAL%$i$ + %i(1))	:i if $ObjectExists$$id$ = %GLOBAL%$name$		:i $persistent_band_move_and_orient_band_member$$name$ = %GLOBAL%$name$	:i else 		:i return 	:i endif	:i $i$ = (%GLOBAL%$i$ + %i(1))	:i loop_to %i(4)	:i endfunction]Script persistent_band_update_all_aliases 0x61a74339 [	:i $rocker_part$ = $None$	:i $RemoveAlias$${StructQBKey guitarist}$	:i $RemoveAlias$${StructQBKey bassist}$	:i $RemoveAlias$${StructQBKey vocalist}$	:i $RemoveAlias$${StructQBKey drummer}$	:i $RemoveAlias$${StructQBKey rocker}$	:i $RemoveAlias$${StructQBKey power_rocker}$	:i $gamemode_gettype$	:i if (%GLOBAL%$type$ = $career$ AND ~$g_net_leader_player_num$ >= %i(0))		:i $getplayerinfo$${			StructQBString g_net_leader_player_num			StructQBKey part			StructQBKey out = rocker_part		}$			:i endif	:i $i$ = %i(0)	:i while 	:i $FormatText$$checksumname$ = $name$%s("musician%i")$i$ = (%GLOBAL%$i$ + %i(1))	:i $part$ = (~$g_persistent_band_data$:a{%GLOBAL%$i$:a}->$Instrument$)	:i if (~$g_current_band$ !== $default_band$)		:i $persistent_band_get_celeb_part_from_character_id$:s{			:i $character_id$ = (~$g_persistent_band_data$:a{%GLOBAL%$i$:a}->$character_id$)		:i :s}		:i $part$ = %GLOBAL%$celeb_part$	:i endif	:i $persistent_band_update_alias$$name$ = %GLOBAL%$name$$part$ = %GLOBAL%$part$	:i if (%GLOBAL%$type$ = $career$)		:i if (%GLOBAL%$part$ = %GLOBAL%$rocker_part$)			:i $AssignAlias$$id$ = %GLOBAL%$name$$alias$ = $rocker$		:i elseif (%GLOBAL%$part$ = ~$g_power_rocker_part$)			:i $AssignAlias$$id$ = %GLOBAL%$name$$alias$ = $power_rocker$		:i endif	:i endif	:i $i$ = (%GLOBAL%$i$ + %i(1))	:i loop_to %i(4)	:i endfunction]Script persistent_band_update_alias 0x68708bf4 [	:i $RequireParams$${		StructArray 0x00000000		{			ArrayQBKey			[				name				part			]		}		StructQBKey all	}$		:i $persistent_band_get_alias_from_part$$part$ = %GLOBAL%$part$	:i $extendcrc$%GLOBAL%$name$%s("_Info")$out$ = $info_struct$	:i $change$$structurename$ = %GLOBAL%$info_struct$$position$ = %GLOBAL%$alias$	:i if $ObjectExists$$id$ = %GLOBAL%$name$		:i $AssignAlias$$id$ = %GLOBAL%$name$$alias$ = %GLOBAL%$alias$	:i endif	:i if $cas_get_lightgroup$$position$ = %GLOBAL%$alias$$id$ = %GLOBAL%$name$		:i $SetLightGroups$$id$ = %GLOBAL%$name$$lightgroup$ = %GLOBAL%$lightgroup$	:i endif	:i endfunction]Script persistent_band_get_celeb_part_from_character_id 0x18eea431 [	:i $RequireParams$${		StructArray 0x00000000		{			ArrayQBKey			[				character_id			]		}		StructQBKey all	}$		:i $band$ = (~$g_current_band$)	:i %GLOBAL%$part$ = $None$	:i if ((~%GLOBAL%$band$->$guitarist$) = %GLOBAL%$character_id$)		:i $part$ = $guitar$	:i elseif ((~%GLOBAL%$band$->$bassist$) = %GLOBAL%$character_id$)		:i $part$ = $Bass$	:i elseif ((~%GLOBAL%$band$->$vocalist$) = %GLOBAL%$character_id$)		:i $part$ = $Vocals$	:i elseif ((~%GLOBAL%$band$->$drummer$) = %GLOBAL%$character_id$)		:i $part$ = $drum$	:i else 		:i $printstruct$(~%GLOBAL%$band$)		:i $persistent_band_print_info$${StructQBKey channel = main}$		:i $scriptassert$^[c69250e3]^$c$ = %GLOBAL%$character_id$$b$ = ~$g_current_band$		:i return 	:i endif	:i return $celeb_part$ = %GLOBAL%$part$	:i endfunction]Script reset_parts_with_mic 0x4f74fc3a [	:i return 	:i $i$ = %i(1)	:i while 	:i $SetPlayerInfo$%GLOBAL%$i$$has_mic$ = %i(0)	:i $i$ = (%GLOBAL%$i$ + %i(1))	:i loop_to %i(4)	:i endfunction]Script set_parts_with_mic 0x620f2155 [	:i $i$ = %i(1)	:i while 	:i $SetPlayerInfo$%GLOBAL%$i$$has_mic$ = %i(1)	:i $i$ = (%GLOBAL%$i$ + %i(1))	:i loop_to %i(8)	:i return 	:i $reset_parts_with_mic$	:i if ((~$g_allow_moments$ = $false$) OR (~$g_using_traditional_band_setup$ = $false$))		:i return 	:i endif	:i $get_song_struct$$song$ = %GLOBAL%$current_song$	:i if NOT $StructureContains$$structure$ = %GLOBAL%$song_struct$$parts_with_mic$		:i return 	:i endif	:i $i$ = %i(1)	:i while 	:i $getplayerinfo$%GLOBAL%$i$$part$	:i switch %GLOBAL%$part$		:i case $guitar$			:i $position$ = $guitarist$			:i endcase		case $Bass$			:i $position$ = $bassist$			:i endcase		case $drum$			:i $position$ = $drummer$			:i endcase		case $Vocals$			:i $position$ = $vocalist$			:i endcase		default 			:i $scriptassert$%s("set_parts_with_mic has unknown part %p")$p$ = %GLOBAL%$part$	:i end_switch	:i if $ArrayContains$$array$ = (%GLOBAL%$song_struct$->$parts_with_mic$)$contains$ = %GLOBAL%$position$		:i $SetPlayerInfo$%GLOBAL%$i$$has_mic$ = %i(1)	:i endif	:i $i$ = (%GLOBAL%$i$ + %i(1))	:i loop_to %i(4)	:i endfunction]Script using_singing_guitarist ad9e7b26 [	:i $gamemode_gettype$	:i if (%GLOBAL%$type$ = $career$)		:i $Playlist_GetCurrentSong$		:i $get_band_configuration$$song$ = %GLOBAL%$current_song$		:i if (%GLOBAL%$band$ !== $default_band$)			:i if $StructureContains$$structure$ = ~%GLOBAL%$band$$vocalist_has_guitar$				:i return ${StructQBKey true}$			:i endif		:i endif	:i endif	:i return ${StructQBKey false}$	:i endfunction]Script venue_should_use_song_performance 0x1cd086af [	${StructQBKey song = None}$	:i $current_zone$ = ((~$LevelZones$->~$current_level$)->$zone$)	:i switch %GLOBAL%$song$		:i case $dontspeak$			:i if (%GLOBAL%$current_zone$ !== $Z_Awardshow$)				:i return ${StructQBKey false}$			:i endif			:i endcase		case $justagirl$			:i if (%GLOBAL%$current_zone$ !== $Z_Paris$)				:i return ${StructQBKey false}$			:i endif			:i endcase		case $lovestory$			:i if (%GLOBAL%$current_zone$ !== $Z_CentralPark$)				:i return ${StructQBKey false}$			:i endif			:i endcase		case $picturetoburn$			:i endcase		case $youbelongwithme$			:i if (%GLOBAL%$current_zone$ !== $z_gorge$)				:i return ${StructQBKey false}$			:i endif			:i endcase		case $shewillbeloved$			:i if (%GLOBAL%$current_zone$ !== $Z_Tokyo$)				:i return ${StructQBKey false}$			:i endif			:i endcase		case $None$			:i $scriptassert$${StructString 0x00000000 = "Called venue_should_use_song_performance without passing a song param"}$			:i endcase		default 	:i end_switch	:i return ${StructQBKey true}$	:i endfunction]Script change_band_for_song 0x7be9e3d4 [	${		StructInt use_power_rocker = 0		StructInt transformation = 0		StructQBKey override_band = None	}$		:i $change$${StructQBKey g_current_band = default_band}$	:i %GLOBAL%$song_is_downloaded$ = %i(0)	:i $Playlist_GetCurrentSong$	:i if $StructureContains$$structure$ = ~$download_songlist_props$%GLOBAL%$current_song$		:i %GLOBAL%$song_is_downloaded$ = %i(1)	:i endif	:i $gamemode_gettype$	:i if (%GLOBAL%$type$ = $career$)		:i if (%GLOBAL%$override_band$ !== $None$)			:i %GLOBAL%$rocker_band$ = %GLOBAL%$override_band$		:i else 			:i if $StructureContains$$structure$ = (~$LevelZones$->~$current_level$)$Career_Band$				:i %GLOBAL%$rocker_band$ = ((~$LevelZones$->~$current_level$)->$Career_Band$)			:i else 				:i %GLOBAL%$rocker_band$ = $RockerBand_GH_Rocker_NewMale$			:i endif		:i endif		:i %GLOBAL%$player_num$ = %i(1)		:i if (~$g_net_leader_player_num$ > %i(0))			:i %GLOBAL%$player_num$ = ~$g_net_leader_player_num$		:i endif		:i $getplayerinfo$%GLOBAL%$player_num$$part$$out$ = $rocker_part$		:i $getplayerinfo$%GLOBAL%$player_num$$character_savegame$		:i switch %GLOBAL%$rocker_part$			:i case $guitar$				:i %GLOBAL%$position$ = $guitarist$				:i endcase			case $Bass$				:i %GLOBAL%$position$ = $bassist$				:i endcase			case $drum$				:i %GLOBAL%$position$ = $drummer$				:i endcase			case $Vocals$				:i %GLOBAL%$position$ = $vocalist$				:i endcase			default 				:i $scriptassert$%s("change_band_for_song has unknown part %p")$p$ = %GLOBAL%$part$		:i end_switch		:i if $current_song_has_female_vocalist$			:i $female_vocals$ = %i(1)		:i else 			:i $female_vocals$ = %i(0)		:i endif		:i if (%GLOBAL%$use_power_rocker$ = %i(0) AND %GLOBAL%$transformation$ = %i(0))			:i if $quest_progression_current_chapter_transformed$				:i %GLOBAL%$use_power_rocker$ = %i(1)			:i else 				:i if $console_is_net_career_client$					:i %GLOBAL%$encore_ready$ = (~$g_net_career_progression$->$career_progression_tags$->$encore_ready$)				:i else 					:i $GetGlobalTags$${						StructQBKey career_progression_tags						StructQBKey param = encore_ready					}$									:i endif				:i if (%GLOBAL%$encore_ready$ = %i(1))					:i if NOT $is_encore_song$						:i %GLOBAL%$transformation$ = %i(1)					:i endif				:i endif			:i endif		:i endif		:i $career_band_update$:s{			:i $band$ = %GLOBAL%$rocker_band$			:i $rocker_part$ = %GLOBAL%$position$			:i $female_vocals$ = %GLOBAL%$female_vocals$			:i $savegame$ = %GLOBAL%$character_savegame$			:i $use_power_rocker$ = %GLOBAL%$use_power_rocker$			:i $transformation$ = %GLOBAL%$transformation$		:i :s}		:i $change$${StructQBKey g_current_band = g_career_band}$		:i %GLOBAL%$band$ = $g_career_band$		:i if (%GLOBAL%$band$ !== $default_band$)			:i $i$ = %i(0)			:i while 			:i $FormatText$$checksumname$ = $name$%s("musician%i")$i$ = (%GLOBAL%$i$ + %i(1))			:i $extendcrc$%GLOBAL%$name$%s("_Info")$out$ = $info_struct$			:i $position$ = (~%GLOBAL%$info_struct$->$position$)			:i $band_character$ = (~%GLOBAL%$band$->%GLOBAL%$position$)			:i $player$ = (~$g_persistent_band_data$:a{%GLOBAL%$i$:a}->$player$)			:i if (%GLOBAL%$player$ < %i(0))				:i %GLOBAL%$player$ = (%GLOBAL%$i$ + %i(1))			:i endif			:i if (%GLOBAL%$band_character$ !== $SavedBandMember$)				:i $character_id$ = (~%GLOBAL%$band$->%GLOBAL%$position$)				:i switch %GLOBAL%$position$					:i case $guitarist$						:i $part$ = $guitar$						:i endcase					case $bassist$						:i $part$ = $Bass$						:i endcase					case $drummer$						:i $part$ = $drum$						:i endcase					case $vocalist$						:i if $StructureContains$$structure$ = ~%GLOBAL%$band$$vocalist_has_guitar$							:i $part$ = $vocals_and_guitar$						:i else 							:i $part$ = $Vocals$						:i endif						:i endcase					default 						:i $scriptassert$%s("change_band_for_song has unknown position %p")$p$ = %GLOBAL%$position$				:i end_switch				:i %GLOBAL%$refresh$ = %i(0)				:i $object_data$ = (~$g_persistent_band_data$:a{%GLOBAL%$i$:a})				:i if ((%GLOBAL%$object_data$->$character_id$) !== %GLOBAL%$character_id$)					:i $refresh$ = %i(1)				:i endif				:i if ((%GLOBAL%$object_data$->$Instrument$) !== %GLOBAL%$part$)					:i $refresh$ = %i(1)				:i endif				:i if NOT $CompositeObjectExists$$name$ = (%GLOBAL%$object_data$->$object$)					:i $refresh$ = %i(1)				:i endif				:i if ((%GLOBAL%$object_data$->$building$) = %i(1))					:i $refresh$ = %i(1)				:i endif				:i if (%GLOBAL%$refresh$ = %i(1))					:i $override$ = :s{						:i $character_id$ = %GLOBAL%$character_id$						:i $part$ = %GLOBAL%$part$					:i :s}					:i $persistent_band_refresh_character$:s{						:i $index$ = %GLOBAL%$i$						:i $player$ = %GLOBAL%$player$						:i $override$ = %GLOBAL%$override$					:i :s}				:i endif			:i endif			:i $i$ = (%GLOBAL%$i$ + %i(1))			:i loop_to %i(4)		:i endif		:i return ${StructQBKey true}$	:i endif	:i return ${StructQBKey false}$	:i endfunction]Script persistent_band_get_correct_vocals_character d2939741 [	:i $RequireParams$${		StructArray 0x00000000		{			ArrayQBKey			[				player			]		}		StructQBKey all	}$		:i if $GotParam$${StructQBKey reset_vocalist}$		:i return ${StructQBKey false}$	:i endif	:i $Playlist_GetCurrentSong$	:i if (%GLOBAL%$current_song$ = $null$ OR %GLOBAL%$current_song$ = $None$)		:i return ${StructQBKey false}$	:i endif	:i if (~$override_band_members$ = %i(1))		:i return ${StructQBKey false}$	:i endif	:i if NOT $GotParam$${StructQBKey startup}$		:i if $playerinfoequals$%GLOBAL%$player$$is_local_client$ = %i(0)			:i return ${StructQBKey false}$		:i endif		:i $getplayerinfo$%GLOBAL%$player$$band_member$		:i $persistent_band_get_index_from_object_id$$object$ = %GLOBAL%$band_member$		:i $gamemode_gettype$		:i if (%GLOBAL%$type$ = $freeplay$ OR ~$in_sing_a_long$ = $true$)			:i $name$ = (~$g_persistent_band_data$:a{%GLOBAL%$index$:a}->$object$)			:i $extendcrc$%GLOBAL%$name$%s("_Info")$out$ = $info_struct$			:i $position$ = (~%GLOBAL%$info_struct$->$position$)			:i if (%GLOBAL%$position$ = $vocalist$)				:i $proceed$ = %i(1)			:i endif		:i else 			:i $getplayerinfo$%GLOBAL%$player$$part$			:i if (%GLOBAL%$part$ = $Vocals$)				:i $getplayerinfo$%GLOBAL%$player$$in_game$				:i if (%GLOBAL%$in_game$ = %i(0))					:i $proceed$ = %i(1)				:i endif			:i endif		:i endif	:i else 		:i $proceed$ = %i(1)	:i endif	:i if $GotParam$${StructQBKey proceed}$		:i $get_song_struct$$song$ = %GLOBAL%$current_song$		:i if NOT $StructureContains$$structure$ = %GLOBAL%$song_struct$$singer$			:i return ${StructQBKey false}$		:i endif		:i $gender$ = (%GLOBAL%$song_struct$->$singer$)		:i if NOT $GotParam$${StructQBKey startup}$			:i if NOT (%GLOBAL%$type$ = $freeplay$)				:i $getplayerinfo$%GLOBAL%$player$$in_game$				:i if (%GLOBAL%$in_game$ = %i(1) AND ~$in_sing_a_long$ = $false$)					:i return ${StructQBKey false}$				:i endif			:i endif		:i endif		:i if NOT (%GLOBAL%$gender$ = $Male$ OR %GLOBAL%$gender$ = $Female$)			:i return ${StructQBKey false}$		:i endif		:i $RemoveParameter$${StructQBKey song_struct}$		:i $get_savegame_from_player$$player$ = %GLOBAL%$player$		:i $getplayerinfo$%GLOBAL%$player$$character_id$		:i $getplayerinfo$%GLOBAL%$player$$character_savegame$		:i if (%GLOBAL%$character_savegame$ < %i(0))			:i $get_persistent_band_savegame$			:i $SetPlayerInfo$%GLOBAL%$player$$character_savegame$ = %GLOBAL%$savegame$			:i $getplayerinfo$%GLOBAL%$player$$character_savegame$		:i endif		:i if $get_is_female_from_character_id$$character_id$ = %GLOBAL%$character_id$$savegame$ = %GLOBAL%$character_savegame$			:i if (%GLOBAL%$gender$ = $Male$ AND %GLOBAL%$is_female$ = %i(1))				:i $random_character$ = $Male$			:i elseif (%GLOBAL%$gender$ = $Female$ AND %GLOBAL%$is_female$ = %i(0))				:i $random_character$ = $Female$			:i endif			:i $RemoveParameter$${StructQBKey is_female}$		:i endif		:i if $GotParam$${StructQBKey random_character}$			:i if $GotParam$${StructQBKey index}$				:i if $get_is_female_from_character_id$$character_id$ = (~$g_persistent_band_data$:a{%GLOBAL%$index$:a}->$character_id$)$savegame$ = (~$g_persistent_band_data$:a{%GLOBAL%$index$:a}->$savegame$)					:i if (%GLOBAL%$gender$ = $Male$ AND %GLOBAL%$is_female$ = %i(0))						:i $character_id$ = (~$g_persistent_band_data$:a{%GLOBAL%$index$:a}->$character_id$)						:i $character_savegame$ = (~$g_persistent_band_data$:a{%GLOBAL%$index$:a}->$savegame$)						:i $RemoveParameter$${StructQBKey random_character}$					:i elseif (%GLOBAL%$gender$ = $Female$ AND %GLOBAL%$is_female$ = %i(1))						:i $character_id$ = (~$g_persistent_band_data$:a{%GLOBAL%$index$:a}->$character_id$)						:i $character_savegame$ = (~$g_persistent_band_data$:a{%GLOBAL%$index$:a}->$savegame$)						:i $RemoveParameter$${StructQBKey random_character}$					:i endif				:i endif			:i endif		:i endif		:i if $GotParam$${StructQBKey random_character}$			:i $cas_get_random_character$$savegame$ = %GLOBAL%$character_savegame$$part$ = $Vocals$$categories$ = :a{$ghrockers$$presetcars$$cars$:a}%GLOBAL%$random_character$			:i $RemoveParameter$${StructQBKey random_character}$		:i endif		:i if $GotParam$${StructQBKey character_id}$			:i $override$ = :s{$character_id$ = %GLOBAL%$character_id$$savegame$ = %GLOBAL%$character_savegame$:s}			:i if NOT $GotParam$${StructQBKey startup}$				:i if (%GLOBAL%$type$ = $freeplay$ OR ~$in_sing_a_long$ = $true$)					:i $object_data$ = (~$g_persistent_band_data$:a{%GLOBAL%$index$:a})					:i $override$ = :s{%GLOBAL%$override$$part$ = (%GLOBAL%$object_data$->$Instrument$):s}					:i if NOT ((%GLOBAL%$object_data$->$character_id$) = %GLOBAL%$character_id$ AND (%GLOBAL%$object_data$->$savegame$) = %GLOBAL%$character_savegame$)						:i $persistent_band_refresh_character$:s{							:i $index$ = %GLOBAL%$index$							:i $player$ = %GLOBAL%$player$							:i $override$ = %GLOBAL%$override$							:i $savegame$ = %GLOBAL%$character_savegame$						:i :s}						:i return ${StructQBKey true}$					:i endif					:i return ${StructQBKey false}$				:i endif			:i endif			:i return $true$:s{$character_id$ = %GLOBAL%$character_id$$character_savegame$ = %GLOBAL%$character_savegame$$override$ = %GLOBAL%$override$:s}		:i endif	:i endif	:i return ${StructQBKey false}$	:i endfunction]Script pick_random_win_lose_anims 0x4d350ecd [	:i if (~$g_random_win_lose_anim_current_song$ = %GLOBAL%$current_song$)		:i return 	:i endif	:i $change$$g_random_win_lose_anim_current_song$ = %GLOBAL%$current_song$	:i $get_persistent_band_savegame$	:i $selected_win_anims$ = :a{:a}	:i $selected_lose_anims$ = :a{:a}	:i $i$ = %i(1)	:i while 	:i $FormatText$$checksumname$ = $musician$%s("musician%a")$a$ = %GLOBAL%$i$	:i $FormatText$$checksumname$ = $info_struct$%s("musician%a_info")$a$ = %GLOBAL%$i$	:i $part$ = (~%GLOBAL%$info_struct$->$part$)	:i if (%GLOBAL%$part$ = $Vocals$)		:i if $using_singing_guitarist$			:i $part$ = $guitar$		:i endif	:i endif	:i $gender$ = $Male$	:i if $CompositeObjectExists$$name$ = %GLOBAL%$musician$		:i %GLOBAL%$musician$.$getsingletag$$is_female$		:i if (%GLOBAL%$is_female$ = %i(1))			:i $gender$ = $Female$		:i endif	:i endif	:i $GetArraySize$(~$Win_Anims$->%GLOBAL%$gender$->%GLOBAL%$part$)	:i $win_array_size$ = %GLOBAL%$array_size$	:i $getrandomvalue$$name$ = $win_index$$a$ = %i(0)$b$ = (%GLOBAL%$array_size$%i(4294967295))$integer$	:i $GetArraySize$(~$Lose_Anims$->%GLOBAL%$gender$->%GLOBAL%$part$)	:i $lose_array_size$ = %GLOBAL%$array_size$	:i $getrandomvalue$$name$ = $lose_index$$a$ = %i(0)$b$ = (%GLOBAL%$array_size$%i(4294967295))$integer$	:i if (%GLOBAL%$i$ > %i(1))		:i while 		:i $used$ = $false$		:i $j$ = %i(0)		:i while 		:i if ((%GLOBAL%$selected_win_anims$:a{%GLOBAL%$j$:a}->$gender$) = %GLOBAL%$gender$			:i AND (%GLOBAL%$selected_win_anims$:a{%GLOBAL%$j$:a}->$part$) = %GLOBAL%$part$			:i AND (%GLOBAL%$selected_win_anims$:a{%GLOBAL%$j$:a}->$index$) = %GLOBAL%$win_index$)			:i $used$ = $true$			:i continue		:i endif		:i $j$ = (%GLOBAL%$j$ + %i(1))		:i loop_to (%GLOBAL%$i$%i(4294967295))		:i if (%GLOBAL%$used$ = $false$)			:i continue		:i endif		:i $win_index$ = (%GLOBAL%$win_index$ + %i(1))		:i if (%GLOBAL%$win_index$ >= %GLOBAL%$win_array_size$)			:i $win_index$ = %i(0)		:i endif		:i loop_to %GLOBAL%$win_array_size$		:i while 		:i $used$ = $false$		:i $j$ = %i(0)		:i while 		:i if ((%GLOBAL%$selected_lose_anims$:a{%GLOBAL%$j$:a}->$gender$) = %GLOBAL%$gender$			:i AND (%GLOBAL%$selected_lose_anims$:a{%GLOBAL%$j$:a}->$part$) = %GLOBAL%$part$			:i AND (%GLOBAL%$selected_lose_anims$:a{%GLOBAL%$j$:a}->$index$) = %GLOBAL%$lose_index$)			:i $used$ = $true$			:i continue		:i endif		:i $j$ = (%GLOBAL%$j$ + %i(1))		:i loop_to (%GLOBAL%$i$%i(4294967295))		:i if (%GLOBAL%$used$ = $false$)			:i continue		:i endif		:i $lose_index$ = (%GLOBAL%$lose_index$ + %i(1))		:i if (%GLOBAL%$lose_index$ >= %GLOBAL%$lose_array_size$)			:i $lose_index$ = %i(0)		:i endif		:i loop_to %GLOBAL%$lose_array_size$	:i endif	:i $win_anim$ = (~$Win_Anims$->%GLOBAL%$gender$->%GLOBAL%$part$:a{%GLOBAL%$win_index$:a})	:i $lose_anim$ = (~$Lose_Anims$->%GLOBAL%$gender$->%GLOBAL%$part$:a{%GLOBAL%$lose_index$:a})	:i if (~$g_use_largest_lose_win_anims$ = %i(1))		:i $AnimLoadGetFourLargestAssets$${StructQBString struct = Win_Anims}$		:i $win_anim$ = (%GLOBAL%$largest_assets$:a{(%GLOBAL%$i$ - %i(1)):a})		:i $AnimLoadGetFourLargestAssets$${StructQBString struct = Lose_Anims}$		:i $lose_anim$ = (%GLOBAL%$largest_assets$:a{(%GLOBAL%$i$ - %i(1)):a})	:i endif	:i $intro_anim$ = $None$	:i switch %GLOBAL%$part$		:i case $guitar$			:i $intro_anim$ = $guit_greg_notempo_01$			:i endcase		case $Bass$			:i $intro_anim$ = $Guit_Greg_NoTempo_02$			:i endcase		case $Vocals$			:i $intro_anim$ = $sing_greg_notempo$			:i endcase		case $drum$			:i $intro_anim$ = $None$			:i endcase		default 			:i $scriptassert$%s("pick_random_win_lose_anims has unknown part %p")$p$ = %GLOBAL%$part$	:i end_switch	:i $object_data$ = (~$g_persistent_band_data$:a{(%GLOBAL%$i$%i(4294967295)):a})	:i if $CharacterProfileGetStruct$$name$ = (%GLOBAL%$object_data$->$character_id$)$savegame$ = %GLOBAL%$savegame$		:i if $GotParam$${StructQBKey profile_struct}$			:i if $StructureContains$${					StructQBKey structure = profile_struct					StructQBKey intro_anims				}$								:i $intro_anims$ = (%GLOBAL%$profile_struct$->$intro_anims$)				:i $GetArraySize$%GLOBAL%$intro_anims$				:i $getrandomvalue$$name$ = $index$$a$ = %i(0)$b$ = (%GLOBAL%$array_size$%i(4294967295))$integer$				:i $intro_anim$ = (%GLOBAL%$intro_anims$:a{%GLOBAL%$index$:a})				:i $scriptassert$${StructString 0x00000000 = "Come talk to Gavin if you hit this - We need to ensure these anims fit within budget"}$			:i endif			:i if $StructureContains$${					StructQBKey structure = profile_struct					StructQBKey Win_Anims				}$								:i $Win_Anims$ = (%GLOBAL%$profile_struct$->$Win_Anims$)				:i $GetArraySize$%GLOBAL%$Win_Anims$				:i $getrandomvalue$$name$ = $index$$a$ = %i(0)$b$ = (%GLOBAL%$array_size$%i(4294967295))$integer$				:i $win_anim$ = (%GLOBAL%$Win_Anims$:a{%GLOBAL%$index$:a})				:i $scriptassert$${StructString 0x00000000 = "Come talk to Gavin if you hit this - We need to ensure these anims fit within budget"}$			:i endif			:i if $StructureContains$${					StructQBKey structure = profile_struct					StructQBKey Lose_Anims				}$								:i $Lose_Anims$ = (%GLOBAL%$profile_struct$->$Lose_Anims$)				:i $GetArraySize$%GLOBAL%$Lose_Anims$				:i $getrandomvalue$$name$ = $index$$a$ = %i(0)$b$ = (%GLOBAL%$array_size$%i(4294967295))$integer$				:i $lose_anim$ = (%GLOBAL%$Lose_Anims$:a{%GLOBAL%$index$:a})				:i $scriptassert$${StructString 0x00000000 = "Come talk to Gavin if you hit this - We need to ensure these anims fit within budget"}$			:i endif			:i $RemoveParameter$${StructQBKey profile_struct}$		:i endif	:i endif	:i $change$$structurename$ = %GLOBAL%$info_struct$$win_anim_name$ = %GLOBAL%$win_anim$	:i $change$$structurename$ = %GLOBAL%$info_struct$$lose_anim_name$ = %GLOBAL%$lose_anim$	:i $change$$structurename$ = %GLOBAL%$info_struct$$intro_anim_name$ = %GLOBAL%$intro_anim$	:i $win_anim_info$ = :s{		:i $gender$ = %GLOBAL%$gender$		:i $part$ = %GLOBAL%$part$		:i $index$ = %GLOBAL%$win_index$	:i :s}	:i $AddArrayElement$$array$ = %GLOBAL%$selected_win_anims$$element$ = %GLOBAL%$win_anim_info$	:i $selected_win_anims$ = %GLOBAL%$array$	:i $lose_anim_info$ = :s{		:i $gender$ = %GLOBAL%$gender$		:i $part$ = %GLOBAL%$part$		:i $index$ = %GLOBAL%$win_index$	:i :s}	:i $AddArrayElement$$array$ = %GLOBAL%$selected_lose_anims$$element$ = %GLOBAL%$lose_anim_info$	:i $selected_lose_anims$ = %GLOBAL%$array$	:i $i$ = (%GLOBAL%$i$ + %i(1))	:i loop_to %i(4)	:i endfunction]Script persistent_band_move_and_orient_band_member ca2fbcbd [	:i $RequireParams$${		StructArray 0x00000000		{			ArrayQBKey			[				name			]		}		StructQBKey all	}$		:i $extendcrc$%GLOBAL%$name$%s("_Info")$out$ = $info_struct$	:i $get_start_node_id$$member$ = %GLOBAL%$name$	:i if $GotParam$${StructQBKey waypoint_id}$		:i if $DoesWayPointExist$$name$ = %GLOBAL%$waypoint_id$			:i $GetWaypointPos$$name$ = %GLOBAL%$waypoint_id$			:i $GetWaypointQuat$$name$ = %GLOBAL%$waypoint_id$			:i $change$$structurename$ = %GLOBAL%$info_struct$$target_node$ = %GLOBAL%$waypoint_id$			:i %GLOBAL%$name$.$obj_setposition$$position$ = %GLOBAL%$Pos$			:i %GLOBAL%$name$.$obj_setorientation$$Quat$ = %GLOBAL%$Quat$			:i return 		:i endif	:i endif	:i endfunction]Script persistent_band_stop_and_unload_anims e3c45c3f [	:i $Drummer_Kill_Spawnscripts$	:i $Vocalist_Reset_Globals$	:i $autolook_kill_Spawnscripts$	:i $crowd_Kill_Spawnscripts$	:i $band_stop_anims$	:i $band_unload_anim_paks$	:i endfunction]Script persistent_band_get_index_from_object_id b0e1e4eb [	:i $RequireParams$${		StructArray 0x00000000		{			ArrayQBKey			[				object			]		}		StructQBKey all	}$		:i $get_musician_id$$name$ = %GLOBAL%$object$	:i switch %GLOBAL%$name$		:i case $musician1$			:i $index$ = %i(0)			:i endcase		case $musician2$			:i $index$ = %i(1)			:i endcase		case $musician3$			:i $index$ = %i(2)			:i endcase		case $musician4$			:i $index$ = %i(3)			:i endcase		default 			:i $scriptassert$^[c28a3b17]^$i$ = %GLOBAL%$name$	:i end_switch	:i return $index$ = %GLOBAL%$index$	:i endfunction]Script persistent_band_get_index_from_player cdb78660 [	:i $RequireParams$${		StructArray 0x00000000		{			ArrayQBKey			[				player			]		}		StructQBKey all	}$		:i $i$ = %i(0)	:i while 	:i if ((~$g_persistent_band_data$:a{%GLOBAL%$i$:a}->$player$) = %GLOBAL%$player$)		:i return $index$ = %GLOBAL%$i$	:i endif	:i $i$ = (%GLOBAL%$i$ + %i(1))	:i loop_to %i(4)	:i $scriptassert$%s("player %p is not in g_persistent_band_data")$p$ = %GLOBAL%$player$	:i endfunction]Script persistent_band_get_musician_from_part 0x612fafb2 [	${Unknown [00012600b6f08f396969696900000000]}$	:i $i$ = %i(0)	:i while 	:i if ((~$g_persistent_band_data$:a{%GLOBAL%$i$:a}->$Instrument$) = %GLOBAL%$part$)		:i return $index$ = %GLOBAL%$i$	:i endif	:i $i$ = (%GLOBAL%$i$ + %i(1))	:i loop_to %i(4)	:i $scriptassert$%s("Instrument %p is not in g_persistent_band_data")$p$ = %GLOBAL%$part$	:i endfunction]Script persistent_band_set_data a7096352 [	:i if NOT $GotParam$${StructQBKey index}$		:i $RequireParams$${			StructArray 0x00000000			{				ArrayQBKey				[					object				]			}			StructQBKey all		}$				:i $persistent_band_get_index_from_object_id$$object$ = %GLOBAL%$object$	:i endif	:i $RequireParams$${		StructArray 0x00000000		{			ArrayQBKey			[				index			]		}		StructQBKey all	}$		:i $obj_data$ = (~$g_persistent_band_data$:a{%GLOBAL%$index$:a})	:i if NOT $GotParam$${StructQBKey player}$		:i $player$ = (%GLOBAL%$obj_data$->$player$)	:i endif	:i if NOT $GotParam$${StructQBKey building}$		:i $building$ = (%GLOBAL%$obj_data$->$building$)	:i else 		:i $GetLogicFrame$		:i if (%GLOBAL%$building$ = %i(0))			:i $band_lobby_persistent_band_unmask$$player$ = %GLOBAL%$player$$time$ = %GLOBAL%$unmask_time$		:i else 			:i $band_lobby_persistent_band_mask$$player$ = %GLOBAL%$player$		:i endif	:i endif	:i if NOT $GotParam$${StructQBKey Instrument}$		:i $Instrument$ = (%GLOBAL%$obj_data$->$Instrument$)	:i endif	:i if NOT $GotParam$${StructQBKey microphone}$		:i $microphone$ = (%GLOBAL%$obj_data$->$microphone$)	:i endif	:i if NOT $GotParam$${StructQBKey savegame}$		:i $savegame$ = (%GLOBAL%$obj_data$->$savegame$)	:i endif	:i if NOT $GotParam$${StructQBKey character_id}$		:i $character_id$ = (%GLOBAL%$obj_data$->$character_id$)	:i endif	:i if NOT $GotParam$${StructQBKey stored_character_index}$		:i $stored_character_index$ = (%GLOBAL%$obj_data$->$stored_character_index$)	:i endif	:i if NOT $GotParam$${StructQBKey appearance_checksum}$		:i if $GotParam$${StructQBKey appearance}$			:i $get_appearance_checksum$:s{$appearance$ = %GLOBAL%$appearance$$Instrument$ = %GLOBAL%$Instrument$$mic$ = %GLOBAL%$microphone$:s}			:i $appearance_checksum$ = %GLOBAL%$new_appearance_checksum$			:i $RemoveParameter$${StructQBKey appearance}$		:i endif		:i if NOT $GotParam$${StructQBKey appearance_checksum}$			:i $appearance_checksum$ = (%GLOBAL%$obj_data$->$appearance_checksum$)		:i endif	:i endif	:i $new_data$ = :s{		:i $object$ = (%GLOBAL%$obj_data$->$object$)		:i $player$ = %GLOBAL%$player$		:i $Instrument$ = %GLOBAL%$Instrument$		:i $savegame$ = %GLOBAL%$savegame$		:i $character_id$ = %GLOBAL%$character_id$		:i $stored_character_index$ = %GLOBAL%$stored_character_index$		:i $appearance_checksum$ = %GLOBAL%$appearance_checksum$		:i $microphone$ = %GLOBAL%$microphone$		:i $building$ = %GLOBAL%$building$	:i :s}	:i $SetArrayElement$:s{		:i $arrayName$ = $g_persistent_band_data$		:i $globalarray$		:i $index$ = %GLOBAL%$index$		:i $newValue$ = %GLOBAL%$new_data$	:i :s}	:i endfunction]Script persistent_band_refresh_changed_characters 0x6757da34 [	${StructInt async = 0}$	:i if (~$g_persistent_band_initialized$ = %i(0))		:i return 	:i endif	:i $get_player_infos_in_use$	:i $count$ = %i(0)	:i while 	:i $persistent_band_refresh_changed_character$$async$ = %GLOBAL%$async$$player$ = (%GLOBAL%$player_infos_in_use$:a{%GLOBAL%$count$:a})$reset_vocalist$ = %GLOBAL%$reset_vocalist$	:i $count$ = (%GLOBAL%$count$ + %i(1))	:i loop_to %i(4)	:i if (~$in_band_lobby$ = %i(1))		:i if (~$cas_loading_setup$ = $lobby$)			:i $set_cas_loading_setup$${StructQBKey setup = lobby}$		:i endif		:i $player$ = %i(1)		:i while 		:i $FormatText$$checksumname$ = $object_name$%s("musician%i")$i$ = %GLOBAL%$player$		:i if $CompositeObjectExists$$name$ = %GLOBAL%$object_name$			:i %GLOBAL%$object_name$.$UnPause$		:i endif		:i $player$ = (%GLOBAL%$player$ + %i(1))		:i loop_to %i(4)	:i endif	:i endfunction]Script persistent_band_refresh_changed_character cfd8d41e [	:i if (%GLOBAL%$async$ = %i(1))		:i $wait$${			StructInt 1			StructQBKey gameframe		}$			:i endif	:i $refresh$ = %i(0)	:i $getplayerinfo$%GLOBAL%$player$$band_member$	:i $persistent_band_get_index_from_object_id$$object$ = %GLOBAL%$band_member$	:i $getplayerinfo$%GLOBAL%$player$$part$	:i $getplayerinfo$%GLOBAL%$player$$stored_character_index$	:i $getplayerinfo$%GLOBAL%$player$$has_mic$	:i $band_lobby_get_character_id$$player$ = %GLOBAL%$player$	:i $persistent_band_get_correct_vocals_character$$player$ = %GLOBAL%$player$$reset_vocalist$ = %GLOBAL%$reset_vocalist$	:i $object_data$ = (~$g_persistent_band_data$:a{%GLOBAL%$index$:a})	:i if ((%GLOBAL%$object_data$->$character_id$) !== %GLOBAL%$character_id$)		:i $refresh$ = %i(1)	:i endif	:i if ((%GLOBAL%$object_data$->$Instrument$) !== %GLOBAL%$part$)		:i $refresh$ = %i(1)	:i endif	:i if ((%GLOBAL%$object_data$->$savegame$) !== %GLOBAL%$character_savegame$)		:i $refresh$ = %i(1)	:i endif	:i if ((%GLOBAL%$object_data$->$microphone$) !== %GLOBAL%$has_mic$)		:i $refresh$ = %i(1)	:i endif	:i if (%GLOBAL%$async$ = %i(1))		:i $wait$${			StructInt 1			StructQBKey gameframe		}$			:i endif	:i if $CharacterProfileGetStruct$$name$ = %GLOBAL%$character_id$$savegame$ = %GLOBAL%$character_savegame$		:i if $GotParam$${StructQBKey profile_struct}$			:i if $fix_profile_struct_for_career$$profile_struct$ = %GLOBAL%$profile_struct$				:i $profile_struct$ = %GLOBAL%$new_profile_struct$			:i endif			:i if $StructureContains$${					StructQBKey structure = profile_struct					StructQBKey appearance				}$								:i $GenerateChecksumFromStruct$$struct$ = (%GLOBAL%$profile_struct$->$appearance$)			:i endif			:i $RemoveParameter$${StructQBKey profile_struct}$		:i endif		:i if $GotParam$${StructQBKey structure_checksum}$			:i $structure_checksum$ = (%GLOBAL%$structure_checksum$ + %GLOBAL%$part$)			:i if (%GLOBAL%$has_mic$ > %i(0))				:i $structure_checksum$ = (%GLOBAL%$structure_checksum$ + $mic$)			:i endif			:i if ((%GLOBAL%$object_data$->$appearance_checksum$) !== %GLOBAL%$structure_checksum$)				:i $refresh$ = %i(1)			:i endif		:i endif		:i if ((%GLOBAL%$object_data$->$stored_character_index$) !== %GLOBAL%$stored_character_index$)			:i $refresh$ = %i(1)		:i endif		:i if ((%GLOBAL%$object_data$->$player$) !== %GLOBAL%$player$)			:i $persistent_band_set_data$$object$ = %GLOBAL%$band_member$$player$ = %GLOBAL%$player$		:i endif		:i if NOT $CompositeObjectExists$$name$ = %GLOBAL%$band_member$			:i $refresh$ = %i(1)		:i endif		:i if ((%GLOBAL%$object_data$->$building$) = %i(1))			:i $refresh$ = %i(1)		:i endif		:i if (%GLOBAL%$refresh$ = %i(1))			:i $change$${StructQBKey g_random_win_lose_anim_current_song = None}$			:i $persistent_band_refresh_character$$index$ = %GLOBAL%$index$$player$ = %GLOBAL%$player$$override$ = %GLOBAL%$override$		:i else 			:i if (~$in_band_lobby$ = %i(1))				:i $band_lobby_persistent_band_unmask$$player$ = %GLOBAL%$player$			:i endif		:i endif	:i else 		:i $scriptassert$%s("Character profile %p not found in savegame %s")$p$ = %GLOBAL%$character_id$$s$ = %GLOBAL%$character_savegame$	:i endif	:i if (%GLOBAL%$async$ = %i(1))		:i $wait$${			StructInt 1			StructQBKey gameframe		}$			:i endif	:i endfunction]Script persistent_band_refresh_character c956e060 [	:i $RequireParams$${		StructArray 0x00000000		{			ArrayQBKey			[				index				player			]		}		StructQBKey all	}$		:i $name$ = ((~$g_persistent_band_data$:a{%GLOBAL%$index$:a})->$object$)	:i $persistent_band_set_data$$index$ = %GLOBAL%$index$$building$ = %i(1)	:i if NOT $GotParam$${StructQBKey override}$		:i $getplayerinfo$%GLOBAL%$player$$part$		:i $getplayerinfo$%GLOBAL%$player$$stored_character_index$		:i $getplayerinfo$%GLOBAL%$player$$has_mic$		:i $band_lobby_get_character_id$$player$ = %GLOBAL%$player$		:i $persistent_band_maybe_use_worst_case_character$		:i if $CharacterProfileGetStruct$$name$ = %GLOBAL%$character_id$$savegame$ = %GLOBAL%$character_savegame$			:i if $fix_profile_struct_for_career$$profile_struct$ = %GLOBAL%$profile_struct$				:i $profile_struct$ = %GLOBAL%$new_profile_struct$			:i endif			:i if NOT $StructureContains$${					StructQBKey structure = profile_struct					StructQBKey appearance				}$								:i $printstruct$%GLOBAL%$profile_struct$				:i $CharacterProfileDump$				:i $scriptassert$${StructString 0x00000000 = "profile_struct is missing appearance"}$			:i endif			:i if NOT $cas_queue_add_request$:s{					:i $appearance$ = (%GLOBAL%$profile_struct$->$appearance$)					:i $player$ = %GLOBAL%$player$					:i $index$ = %GLOBAL%$index$					:i $Instrument$ = %GLOBAL%$part$					:i $character_id$ = %GLOBAL%$character_id$					:i $savegame$ = %GLOBAL%$character_savegame$					:i $stored_character_index$ = %GLOBAL%$stored_character_index$					:i $has_mic$ = %GLOBAL%$has_mic$					:i $persistent_band$ = %i(1)				:i :s}				:i if $GotParam$${StructQBKey character_is_finished}$					:i $persistent_band_set_data$$index$ = %GLOBAL%$index$$building$ = %i(0)$unmask_time$ = %f(0.0)				:i endif			:i endif		:i else 			:i $scriptassert$%s("Character profile %p not found in savegame %s")$p$ = %GLOBAL%$character_id$$s$ = %GLOBAL%$savegame$		:i endif	:i else 		:i if $StructureContains$$structure$ = %GLOBAL%$override$$character_id$			:i $character_id$ = (%GLOBAL%$override$->$character_id$)		:i endif		:i if $StructureContains$$structure$ = %GLOBAL%$override$$savegame$			:i $savegame$ = (%GLOBAL%$override$->$savegame$)		:i endif		:i if $StructureContains$$structure$ = %GLOBAL%$override$$part$			:i $part$ = (%GLOBAL%$override$->$part$)		:i else 			:i $getplayerinfo$%GLOBAL%$player$$part$		:i endif		:i if (%GLOBAL%$part$ = $vocals_and_guitar$)			:i $has_mic$ = %i(1)		:i else 			:i $getplayerinfo$%GLOBAL%$player$$has_mic$		:i endif		:i if $CharacterProfileGetStruct$$name$ = %GLOBAL%$character_id$$savegame$ = %GLOBAL%$savegame$			:i if $fix_profile_struct_for_career$$profile_struct$ = %GLOBAL%$profile_struct$				:i $profile_struct$ = %GLOBAL%$new_profile_struct$			:i endif			:i if NOT $cas_queue_add_request$:s{					:i $appearance$ = (%GLOBAL%$profile_struct$->$appearance$)					:i $player$ = %GLOBAL%$player$					:i $index$ = %GLOBAL%$index$					:i $Instrument$ = %GLOBAL%$part$					:i $character_id$ = %GLOBAL%$character_id$					:i $savegame$ = %GLOBAL%$savegame$					:i $stored_character_index$ = %GLOBAL%$stored_character_index$					:i $has_mic$ = %GLOBAL%$has_mic$				:i :s}				:i $printf$${					StructString 0x00000000 = "persistent_band call to cas_queue_add_request returned false"					StructQBKey channel = persistent_band				}$								:i if $GotParam$${StructQBKey character_is_finished}$					:i $persistent_band_set_data$$index$ = %GLOBAL%$index$$building$ = %i(0)$unmask_time$ = %f(0.0)				:i endif			:i endif		:i endif	:i endif	:i endfunction]Script persistent_band_play_all_default_anims 0x6baa4473 [	:i $i$ = %i(0)	:i while 	:i $name$ = (~$g_persistent_band_data$:a{%GLOBAL%$i$:a}->$object$)	:i if $ObjectExists$$id$ = %GLOBAL%$name$		:i %GLOBAL%$name$.$persistent_band_play_default_anim$	:i endif	:i $i$ = (%GLOBAL%$i$ + %i(1))	:i loop_to %i(4)	:i endfunction]Script persistent_band_play_default_anim b795ae61 [	:i $obj_getid$	:i $persistent_band_get_index_from_object_id$$object$ = %GLOBAL%$ObjID$	:i $Instrument$ = (~$g_persistent_band_data$:a{%GLOBAL%$index$:a}->$Instrument$)	:i if $getsingletag$${StructQBKey body_checksum}$		:i if (%GLOBAL%$body_checksum$ = $Silhouette_Net$)			:i if (%GLOBAL%$Instrument$ !== $drum$)				:i $Instrument$ = $None$			:i endif		:i endif	:i endif	:i switch %GLOBAL%$Instrument$		:i case $guitar$			:i $anim$ = $guit_greg_notempo_01$			:i endcase		case $Bass$			:i $anim$ = $Guit_Greg_NoTempo_02$			:i endcase		case $Vocals$			:i $anim$ = $sing_greg_notempo$			:i endcase		case $drum$			:i $anim$ = $DrumDroid_Waiting_InOut_Full$			:i endcase		case $None$			:i $anim$ = $guit_greg_notempo_01$			:i endcase		default 			:i $scriptassert$%s("persistent_band_play_default_anim has unknown instrument %i")$i$ = %GLOBAL%$Instrument$	:i end_switch	:i if $GotParam$${StructQBKey anim}$		:i $anim_command$${			StructQBKey target = moment_blend			StructQBKey command = partialswitch_setstate			StructStruct params			{				StructHeader				{					StructQBKey on					StructFloat blendduration = 0.00				}			}		}$				:i $start_time$ = %i(0)		:i switch %GLOBAL%$ObjID$			:i case $musician1$				:i $start_time$ = %i(0)				:i endcase			case $musician2$				:i $start_time$ = %f(0.25)				:i endcase			case $musician3$				:i $start_time$ = %f(0.5)				:i endcase			case $musician4$				:i $start_time$ = %f(0.75)				:i endcase			default 				:i $scriptassert$%s("persistent_band_play_default_anim has unknown objId %o")$o$ = %GLOBAL%$ObjID$		:i end_switch		:i $anim_command$:s{			:i $target$ = $moment_branch$			:i $command$ = $degenerateblend_addbranch$			:i $params$ = :s{				:i $tree$ = ~$hero_cycle_branch$				:i $blendduration$ = %i(0)				:i $params$ = :s{					:i $anim_name$ = %GLOBAL%$anim$					:i $timer_id$ = $momenttimer$					:i $start_time$ = %GLOBAL%$start_time$				:i :s}			:i :s}		:i :s}	:i endif	:i $band_setikchain$$name$ = %GLOBAL%$ObjID$$chain$ = $slave$	:i %GLOBAL%$ObjID$.$Obj_Teleport$	:i endfunction]Script persistent_band_print_info 0x2c128ef0 [	${StructQBKey channel = persistent_band}$	:i if (%GLOBAL%$channel$ = $main$)		:i $RemoveParameter$${StructQBKey channel}$	:i endif	:i $get_player_infos_in_use$	:i $count$ = %i(0)	:i while 	:i $i$ = (%GLOBAL%$player_infos_in_use$:a{%GLOBAL%$count$:a})	:i $getplayerinfo$%GLOBAL%$i$$band_member$	:i $printf$^[65ddfbeb]^$i$ = %GLOBAL%$band_member$$channel$ = %GLOBAL%$channel$	:i $persistent_band_get_index_from_object_id$$object$ = %GLOBAL%$band_member$	:i $getplayerinfo$%GLOBAL%$i$$character_id$	:i $getplayerinfo$%GLOBAL%$i$$part$	:i $getplayerinfo$%GLOBAL%$i$$character_savegame$	:i $getplayerinfo$%GLOBAL%$i$$stored_character_index$	:i $getplayerinfo$%GLOBAL%$i$$has_mic$	:i $object_data$ = (~$g_persistent_band_data$:a{%GLOBAL%$index$:a})	:i $printstruct$ isNull $channel$ = %GLOBAL%$channel$	:i $count$ = (%GLOBAL%$count$ + %i(1))	:i loop_to %i(4)	:i endfunction]Script persistent_band_maybe_use_worst_case_character 0x3a517070 [	:i if NOT (~$use_worst_band$ = %i(0))		:i if (~$use_worst_band$ = $Male$)			:i return ${StructQBKey character_id = WorstMaleCharacter}$		:i else 			:i return ${StructQBKey character_id = WorstFemaleCharacter}$		:i endif	:i endif	:i endfunction]Script persistent_band_force_traditional_band db203949 [	:i if $GotParam$${StructQBKey test}$		:i $SetPlayerInfo$${			StructInt 1			StructQBKey part = Bass		}$				:i $SetPlayerInfo$${			StructInt 2			StructQBKey part = drum		}$				:i $SetPlayerInfo$${			StructInt 3			StructQBKey part = drum		}$				:i $SetPlayerInfo$${			StructInt 4			StructQBKey part = Bass		}$			:i endif	:i $used_parts$ = :a{%i(0)%i(0)%i(0)%i(0):a}	:i $ok_players$ = :a{%i(0)%i(0)%i(0)%i(0):a}	:i $part_checksums$ = :a{$guitar$$Vocals$$Bass$$drum$:a}	:i $get_player_infos_in_use$	:i $i$ = %i(0)	:i while 	:i $player$ = (%GLOBAL%$player_infos_in_use$:a{%GLOBAL%$i$:a})	:i $getplayerinfo$%GLOBAL%$player$$part$	:i switch %GLOBAL%$part$		:i case $guitar$			:i $index$ = %i(0)			:i endcase		case $Vocals$			:i $index$ = %i(1)			:i endcase		case $Bass$			:i $index$ = %i(2)			:i endcase		case $drum$			:i $index$ = %i(3)			:i endcase		default 			:i $scriptassert$%s("persistent_band_force_traditional_band has unknown part %p")$p$ = %GLOBAL%$part$	:i end_switch	:i if ((%GLOBAL%$used_parts$:a{%GLOBAL%$index$:a}) = %i(0))		:i $SetArrayElement$$arrayName$ = $used_parts$$index$ = %GLOBAL%$index$$newValue$ = %i(1)		:i $SetArrayElement$$arrayName$ = $ok_players$$index$ = %GLOBAL%$i$$newValue$ = %i(1)	:i endif	:i $i$ = (%GLOBAL%$i$ + %i(1))	:i loop_to %i(4)	:i $i$ = %i(0)	:i while 	:i if ((%GLOBAL%$ok_players$:a{%GLOBAL%$i$:a}) = %i(0))		:i $z$ = %i(0)		:i while 		:i if ((%GLOBAL%$used_parts$:a{%GLOBAL%$z$:a}) = %i(0))			:i $SetArrayElement$$arrayName$ = $used_parts$$index$ = %GLOBAL%$z$$newValue$ = %i(1)			:i continue		:i endif		:i $z$ = (%GLOBAL%$z$ + %i(1))		:i loop_to %i(4)		:i $player$ = (%GLOBAL%$player_infos_in_use$:a{%GLOBAL%$i$:a})		:i $SetPlayerInfo$%GLOBAL%$player$$part$ = (%GLOBAL%$part_checksums$:a{%GLOBAL%$z$:a})	:i endif	:i $i$ = (%GLOBAL%$i$ + %i(1))	:i loop_to %i(4)	:i $copy_parts_to_stored_parts$	:i $persistent_band_refresh_changed_characters$	:i if $GotParam$${StructQBKey test}$		:i $getplayerinfo$${			StructInt 1			StructQBKey part			StructQBKey out = part1		}$				:i $getplayerinfo$${			StructInt 2			StructQBKey part			StructQBKey out = part2		}$				:i $getplayerinfo$${			StructInt 3			StructQBKey part			StructQBKey out = part3		}$				:i $getplayerinfo$${			StructInt 4			StructQBKey part			StructQBKey out = part4		}$				:i $printstruct$ isNull $channel$ = $persistent_band$	:i endif	:i endfunction]Script persistent_band_hide_nonvocalist_mics e29c1567 [	:i $get_player_infos_in_use$	:i $i$ = %i(0)	:i while 	:i $player$ = (%GLOBAL%$player_infos_in_use$:a{%GLOBAL%$i$:a})	:i $getplayerinfo$%GLOBAL%$player$$part$	:i $getplayerinfo$%GLOBAL%$player$$band_member$	:i if (%GLOBAL%$part$ !== $Vocals$)		:i if $ObjectExists$$id$ = %GLOBAL%$band_member$			:i %GLOBAL%$band_member$.$hide_mic$		:i endif	:i endif	:i $i$ = (%GLOBAL%$i$ + %i(1))	:i loop_to %i(4)	:i endfunction]Script persistent_band_destroy_other_characters 0x297cc5a9 [	:i $RequireParams$${		StructArray 0x00000000		{			ArrayQBKey			[				player			]		}		StructQBKey all	}$		:i $i$ = %i(0)	:i while 	:i $this_player$ = ((~$g_persistent_band_data$:a{%GLOBAL%$i$:a})->$player$)	:i $name$ = ((~$g_persistent_band_data$:a{%GLOBAL%$i$:a})->$object$)	:i if (%GLOBAL%$this_player$ !== %GLOBAL%$player$)		:i $cas_queue_kill_player$$player$ = %GLOBAL%$this_player$		:i $destroy_band_member$$name$ = %GLOBAL%$name$	:i endif	:i $i$ = (%GLOBAL%$i$ + %i(1))	:i loop_to %i(4)	:i endfunction]Script persistent_band_unique_musician_check 0x83fd2d25 [	:i $obj_1$ = %i(0)	:i $obj_2$ = %i(0)	:i $obj_3$ = %i(0)	:i $obj_4$ = %i(0)	:i $get_player_infos_in_use$	:i $i$ = %i(0)	:i while 	:i $getplayerinfo$(%GLOBAL%$player_infos_in_use$:a{%GLOBAL%$i$:a})$band_member$$out$ = $obj_id$	:i switch %GLOBAL%$obj_id$		:i case $musician1$			:i $obj_1$ = (%GLOBAL%$obj_1$ + %i(1))			:i endcase		case $musician2$			:i $obj_2$ = (%GLOBAL%$obj_2$ + %i(1))			:i endcase		case $musician3$			:i $obj_3$ = (%GLOBAL%$obj_3$ + %i(1))			:i endcase		case $musician4$			:i $obj_4$ = (%GLOBAL%$obj_4$ + %i(1))			:i endcase		default 			:i $scriptassert$%s("persistent_band_unique_musician_check has unknown obj_id %o")$o$ = %GLOBAL%$obj_id$	:i end_switch	:i $i$ = (%GLOBAL%$i$ + %i(1))	:i loop_to %i(4)	:i if (%GLOBAL%$obj_1$ > %i(1) OR %GLOBAL%$obj_2$ > %i(1) OR %GLOBAL%$obj_3$ > %i(1) OR %GLOBAL%$obj_4$ > %i(1))		:i $persistent_band_print_info$${StructQBKey channel = main}$		:i $scriptassert$${StructString 0x00000000 = "Two or more players have the same object id"}$		:i $persistent_band_force_unique_musicians$	:i endif	:i endfunction]Script persistent_band_force_unique_musicians e51bdcd3 [	:i if $GotParam$${StructQBKey test}$		:i $SetPlayerInfo$${			StructInt 1			StructQBKey band_member = musician3		}$				:i $SetPlayerInfo$${			StructInt 2			StructQBKey band_member = musician3		}$				:i $SetPlayerInfo$${			StructInt 3			StructQBKey band_member = musician3		}$				:i $SetPlayerInfo$${			StructInt 4			StructQBKey band_member = musician3		}$			:i endif	:i $used_musicians$ = :a{%i(0)%i(0)%i(0)%i(0):a}	:i $ok_players$ = :a{%i(0)%i(0)%i(0)%i(0):a}	:i $musician_checksums$ = :a{$musician1$$musician2$$musician3$$musician4$:a}	:i $get_player_infos_in_use$	:i $i$ = %i(0)	:i while 	:i $player$ = (%GLOBAL%$player_infos_in_use$:a{%GLOBAL%$i$:a})	:i $getplayerinfo$%GLOBAL%$player$$band_member$	:i switch %GLOBAL%$band_member$		:i case $musician1$			:i $index$ = %i(0)			:i endcase		case $musician2$			:i $index$ = %i(1)			:i endcase		case $musician3$			:i $index$ = %i(2)			:i endcase		case $musician4$			:i $index$ = %i(3)			:i endcase		default 			:i $scriptassert$%s("persistent_band_force_unique_musicians has unknown band_member %b")$b$ = %GLOBAL%$band_member$	:i end_switch	:i if ((%GLOBAL%$used_musicians$:a{%GLOBAL%$index$:a}) = %i(0))		:i $SetArrayElement$$arrayName$ = $used_musicians$$index$ = %GLOBAL%$index$$newValue$ = %i(1)		:i $SetArrayElement$$arrayName$ = $ok_players$$index$ = %GLOBAL%$i$$newValue$ = %i(1)	:i endif	:i $i$ = (%GLOBAL%$i$ + %i(1))	:i loop_to %i(4)	:i $i$ = %i(0)	:i while 	:i if ((%GLOBAL%$ok_players$:a{%GLOBAL%$i$:a}) = %i(0))		:i $z$ = %i(0)		:i while 		:i if ((%GLOBAL%$used_musicians$:a{%GLOBAL%$z$:a}) = %i(0))			:i $SetArrayElement$$arrayName$ = $used_musicians$$index$ = %GLOBAL%$z$$newValue$ = %i(1)			:i continue		:i endif		:i $z$ = (%GLOBAL%$z$ + %i(1))		:i loop_to %i(4)		:i $player$ = (%GLOBAL%$player_infos_in_use$:a{%GLOBAL%$i$:a})		:i $SetPlayerInfo$%GLOBAL%$player$$band_member$ = (%GLOBAL%$musician_checksums$:a{%GLOBAL%$z$:a})	:i endif	:i $i$ = (%GLOBAL%$i$ + %i(1))	:i loop_to %i(4)	:i if $GotParam$${StructQBKey test}$		:i $getplayerinfo$${			StructInt 1			StructQBKey band_member			StructQBKey out = band_member1		}$				:i $getplayerinfo$${			StructInt 2			StructQBKey band_member			StructQBKey out = band_member2		}$				:i $getplayerinfo$${			StructInt 3			StructQBKey band_member			StructQBKey out = band_member3		}$				:i $getplayerinfo$${			StructInt 4			StructQBKey band_member			StructQBKey out = band_member4		}$				:i $printstruct$ isNull $channel$ = $persistent_band$	:i endif	:i endfunction]Script persistent_band_pause_all_characters f89b2071 [	:i $i$ = %i(0)	:i while 	:i $FormatText$$checksumname$ = $name$%s("musician%i")$i$ = (%GLOBAL%$i$ + %i(1))	:i if $ObjectExists$$id$ = %GLOBAL%$name$		:i if NOT $GotParam$${StructQBKey UnPause}$			:i %GLOBAL%$name$.$Pause$		:i else 			:i %GLOBAL%$name$.$UnPause$		:i endif	:i endif	:i $i$ = (%GLOBAL%$i$ + %i(1))	:i loop_to %i(4)	:i endfunction]Script get_player_infos_in_use 0x5d89f7ff [	:i $player_infos_in_use$ = :a{%i(0)%i(0)%i(0)%i(0):a}	:i $GetFirstPlayer$${StructQBKey on_screen}$	:i $i$ = %i(0)	:i $non_player$ = %i(1)	:i while 	:i if (%GLOBAL%$player$ > %i(0))		:i $SetArrayElement$$arrayName$ = $player_infos_in_use$$index$ = %GLOBAL%$i$$newValue$ = %GLOBAL%$player$		:i $GetNextPlayer$$on_screen$$player$ = %GLOBAL%$player$	:i else 		:i while 		:i if (			:i %GLOBAL%$non_player$ = %GLOBAL%$player_infos_in_use$:a{%i(0):a}			:i OR 			:i %GLOBAL%$non_player$ = %GLOBAL%$player_infos_in_use$:a{%i(1):a}			:i OR 			:i %GLOBAL%$non_player$ = %GLOBAL%$player_infos_in_use$:a{%i(2):a}			:i OR 			:i %GLOBAL%$non_player$ = %GLOBAL%$player_infos_in_use$:a{%i(3):a}			:i )			:i $non_player$ = (%GLOBAL%$non_player$ + %i(1))		:i else 			:i continue		:i endif		:i loop_to 		:i $SetArrayElement$$arrayName$ = $player_infos_in_use$$index$ = %GLOBAL%$i$$newValue$ = %GLOBAL%$non_player$		:i $non_player$ = (%GLOBAL%$non_player$ + %i(1))	:i endif	:i $i$ = (%GLOBAL%$i$ + %i(1))	:i loop_to %i(4)	:i return $player_infos_in_use$ = %GLOBAL%$player_infos_in_use$	:i endfunction]Script persistent_band_get_unused_musician 0x79fe6755 [	:i $obj_1$ = %i(0)	:i $obj_2$ = %i(0)	:i $obj_3$ = %i(0)	:i $obj_4$ = %i(0)	:i $get_player_infos_in_use$	:i $i$ = %i(0)	:i while 	:i $getplayerinfo$(%GLOBAL%$player_infos_in_use$:a{%GLOBAL%$i$:a})$band_member$$out$ = $obj_id$	:i switch %GLOBAL%$obj_id$		:i case $musician1$			:i $obj_1$ = (%GLOBAL%$obj_1$ + %i(1))			:i endcase		case $musician2$			:i $obj_2$ = (%GLOBAL%$obj_2$ + %i(1))			:i endcase		case $musician3$			:i $obj_3$ = (%GLOBAL%$obj_3$ + %i(1))			:i endcase		case $musician4$			:i $obj_4$ = (%GLOBAL%$obj_4$ + %i(1))			:i endcase		default 	:i end_switch	:i $i$ = (%GLOBAL%$i$ + %i(1))	:i loop_to %i(4)	:i if (%GLOBAL%$obj_1$ = %i(0))		:i $unused_musician$ = $musician1$	:i elseif (%GLOBAL%$obj_2$ = %i(0))		:i $unused_musician$ = $musician2$	:i elseif (%GLOBAL%$obj_3$ = %i(0))		:i $unused_musician$ = $musician3$	:i elseif (%GLOBAL%$obj_4$ = %i(0))		:i $unused_musician$ = $musician4$	:i else 		:i $unused_musician$ = $None$	:i endif	:i return $unused_musician$ = %GLOBAL%$unused_musician$	:i endfunction]Script persistent_band_force_create_and_wait 0x8742ed5e [	:i $PushUnsafeForShutdown$${StructQBKey context = persistent_band_force_create_and_wait}$	:i $CasCancelLoading$	:i $cas_destroy_all_characters$	:i $persistent_band_create_band$${StructInt refresh = 1}$	:i if NOT $GotParam$${StructQBKey no_wait}$		:i if $GotParam$${StructQBKey no_block}$			:i $cas_queue_wait$		:i else 			:i $cas_queue_block$		:i endif	:i endif	:i $PopUnsafeForShutdown$${StructQBKey context = persistent_band_force_create_and_wait}$	:i endfunction]Script persistent_band_has_four_musicians 0x886091df [	:i if NOT $ObjectExists$${StructQBKey id = musician1}$		:i return ${StructQBKey false}$	:i elseif NOT $ObjectExists$${StructQBKey id = musician2}$		:i return ${StructQBKey false}$	:i elseif NOT $ObjectExists$${StructQBKey id = musician3}$		:i return ${StructQBKey false}$	:i elseif NOT $ObjectExists$${StructQBKey id = musician4}$		:i return ${StructQBKey false}$	:i endif	:i return ${StructQBKey true}$	:i endfunction]Script persistent_band_finished_building 0x8dc8675c [	${StructInt assert = 0}$	:i $i$ = %i(0)	:i while 	:i if ((~$g_persistent_band_data$:a{%GLOBAL%$i$:a}->$building$) = %i(1))		:i if (%GLOBAL%$assert$ = %i(0))			:i return ${StructQBKey false}$		:i else 			:i $persistent_band_print_info$${StructQBKey channel = main}$			:i $scriptassert$^[19b8fc19]^$i$ = %GLOBAL%$i$		:i endif	:i endif	:i $i$ = (%GLOBAL%$i$ + %i(1))	:i loop_to %i(4)	:i return ${StructQBKey true}$	:i endfunction]Script should_use_alt_positions 0x9c02e06c [	:i $use_alt_positions$ = %i(0)	:i $GetPakManCurrent$${StructQBKey map = zones}$	:i if (%GLOBAL%$pak$ = $z_gorge$)		:i if $GetNodeFlag$${StructQBKey ls_encore_post}$			:i $use_alt_positions$ = %i(1)		:i endif	:i endif	:i $change$$g_band_use_alt_positions$ = %GLOBAL%$use_alt_positions$	:i endfunction]Script current_song_has_female_vocalist ba86a0ec [	:i $Playlist_GetCurrentSong$	:i $get_song_struct$$song$ = %GLOBAL%$current_song$	:i if $StructureContains$$structure$ = %GLOBAL%$song_struct$$singer$		:i if ((%GLOBAL%$song_struct$->$singer$) = $Female$)			:i return ${StructQBKey true}$		:i endif	:i endif	:i return ${StructQBKey false}$	:i endfunction]