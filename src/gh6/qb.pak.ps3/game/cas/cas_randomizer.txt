Unknown [1c00000000000000000021e80000000000000000]SectionArray cas_randomized_parts{	Floats [0.00000, 0.00000]}SectionArray cas_randomized_parts_mixed_genre{	Floats [0.00000, 0.00000]}SectionArray cas_randomized_presets{	ArrayStruct	[		StructHeader		{			StructQBKey preset_type = CAR_Presets_Body		}		StructHeader		{			StructQBKey preset_type = car_presets_face		}		StructHeader		{			StructQBKey preset_type = CAR_Presets_Makeup		}		StructHeader		{			StructQBKey preset_type = CAR_Presets_Tattoo		}		StructHeader		{			StructQBKey preset_type = car_presets_outfit			StructQBKey globaltag_unlocks = unlocked_cas_outfit_presets		}		]}SectionStruct cas_randomized_instruments{	StructHeader	{		StructStruct guitar		{			StructHeader			{				StructQBKey array = cas_random_guitars			}		}		StructStruct Bass		{			StructHeader			{				StructQBKey array = cas_random_basses			}		}		StructStruct drum		{			StructHeader			{				StructQBKey array = cas_random_drums			}		}		StructStruct Vocals		{			StructHeader			{				StructQBKey male_array = cas_random_male_vocals				StructQBKey female_array = cas_random_female_vocals			}		}	}}SectionStruct cas_band_used_parts{	StructHeader {}}SectionInteger cpu_random_character 0Script cas_set_random_appearance 0x12d325eb [	${Unknown [000126007cafcc07696969690000001800012400e5c2f84c6969696900000028000124001b0509c56969696900000000]}$	:i $RequireParams$${		StructArray 0x00000000		{			ArrayQBKey			[				genre				is_female				savegame			]		}		StructQBKey all	}$		:i $printscriptinfo$${StructString 0x00000000 = "cas_set_random_appearance"}$	:i $change$$cas_dupe_appearance$ = (~$cas_current_appearance$)	:i if $GotParam$${StructQBKey used_parts}$		:i $change$$cas_band_used_parts$ = %GLOBAL%$used_parts$	:i else 		:i $change$${			StructStruct cas_band_used_parts			{				StructHeader {}			}		}$			:i endif	:i if $GotParam$${StructQBKey cpu_band}$		:i $change$${StructInt cpu_random_character = 1}$	:i else 		:i $change$${StructInt cpu_random_character = 0}$	:i endif	:i if (%GLOBAL%$is_female$ = %i(1))		:i $change$$cas_current_appearance$ = (~$default_custom_musician_profile_female$->$appearance$)	:i else 		:i $change$$cas_current_appearance$ = (~$default_custom_musician_profile_male$->$appearance$)	:i endif	:i $cas_grab_random_unlocks$	:i $randomize$	:i $stars$	:i $printf$%s("Generating random appearance - Seed=%s genre=%g")$s$ = %GLOBAL%$rand_seed$$g$ = %GLOBAL%$genre$	:i $stars$	:i $random_preset_list$ = (~$cas_randomized_presets$)	:i if (%GLOBAL%$is_female$ = %i(1))		:i %GLOBAL%$gender_checksum$ = $Female$	:i else 		:i %GLOBAL%$gender_checksum$ = $Male$	:i endif	:i $cas_random_pick_random_car_setup$$gender$ = %GLOBAL%$gender_checksum$$genre$ = %GLOBAL%$genre$$savegame$ = %GLOBAL%$savegame$	:i $cas_random_set_hair_from_car_setup$$chosen_setup$ = %GLOBAL%$chosen_setup$	:i $cas_propogate_hair_color$	:i $ForEachIn$%GLOBAL%$random_preset_list$$do$ = $cas_set_random_presets$$params$ = :s{$gender$ = %GLOBAL%$gender_checksum$$savegame$ = %GLOBAL%$savegame$$chosen_setup$ = %GLOBAL%$chosen_setup$:s}	:i if $GotParam$${StructQBKey random_instruments}$		:i $cas_generate_all_random_instruments$$is_female$ = %GLOBAL%$is_female$$genre$ = %GLOBAL%$genre$	:i endif	:i $change$$cas_current_appearance$ = :s{(~$cas_current_appearance$)$genre$ = %GLOBAL%$genre$:s}	:i $change$${		StructArray cas_current_unlock_list		{			Floats [0.00000, 0.00000]		}	}$		:i $change$${StructInt cpu_random_character = 0}$	:i $change$${		StructStruct cas_dupe_appearance		{			StructHeader {}		}	}$		:i endfunction]Script cas_random_pick_random_car_setup a5821c28 [	${Unknown [0001260038b8f5bd6969696900000018000126007cafcc076969696900000028000124001b0509c56969696900000000]}$	:i if (%GLOBAL%$savegame$ >= %i(0))		:i $GetGlobalTags$$unlocked_cas_outfit_presets$$savegame$ = %GLOBAL%$savegame$	:i endif	:i %GLOBAL%$array$ = (~$car_random_car_setups$->%GLOBAL%$gender$)	:i $iLoop$ = %i(0)	:i while 	:i if $PickFromWeightedArray$$weighted_array$ = %GLOBAL%$array$		:i $printf$%s("Picked index %i")$i$ = %GLOBAL%$random_index$		:i %GLOBAL%$chosen_setup$ = (%GLOBAL%$array$:a{%GLOBAL%$random_index$:a})		:i %GLOBAL%$chosen_outfit$ = (%GLOBAL%$chosen_setup$->$car_presets_outfit$)		:i $cas_get_preset_index$$preset_type$ = $car_presets_outfit$$gender$ = %GLOBAL%$gender$$desc_id$ = %GLOBAL%$chosen_outfit$		:i %GLOBAL%$preset_struct$ = ((~$car_presets_outfit$->%GLOBAL%$gender$):a{%GLOBAL%$preset_index$:a})		:i %GLOBAL%$locked$ = %i(0)		:i if $StructureContains$$structure$ = %GLOBAL%$preset_struct$$locked$			:i %GLOBAL%$locked$ = %i(1)			:i if $GotParam$${StructQBKey unlocked_cas_outfit_presets}$				:i if $ArrayContains$$array$ = %GLOBAL%$unlocked_cas_outfit_presets$$contains$ = %GLOBAL%$chosen_outfit$					:i %GLOBAL%$locked$ = %i(0)				:i endif			:i endif		:i endif		:i if (%GLOBAL%$locked$ = %i(1))			:i $RemoveArrayElement$$array$ = %GLOBAL%$array$$index$ = %GLOBAL%$random_index$			:i $printf$${StructString 0x00000000 = "locked outfit, picking again..."}$		:i else 			:i %GLOBAL%$possible_setup$ = %GLOBAL%$chosen_setup$			:i if $check_dupe_appearance$$avoid_dupe_parts$ = :a{$CAS_Torso$$CAS_Legs$:a}$random_preset$ = %GLOBAL%$preset_struct$				:i %GLOBAL%$iLoop$ = (%GLOBAL%$iLoop$ + %i(1))				:i if (%GLOBAL%$iLoop$ = %i(20))					:i $printf$${StructString 0x00000000 = "gave up"}$					:i continue				:i else 					:i $printf$${StructString 0x00000000 = "dupe outfit, picking again..."}$				:i endif			:i else 				:i continue			:i endif		:i endif	:i else 		:i $scriptassert$${StructString 0x00000000 = "Could not pick a random preset!"}$	:i endif	:i loop_to 	:i return $chosen_setup$ = %GLOBAL%$possible_setup$	:i endfunction]Script cas_random_set_hair_from_car_setup dfd47f6a [	${Unknown [00012b008556d2906969696900000000]}$	:i $ResolveBodySpecificPartInAppearance$${StructQBKey part = CAS_Hair}$	:i %GLOBAL%$part_struct$ = (%GLOBAL%$chosen_setup$->%GLOBAL%$part$)	:i $cas_add_item_to_appearance$$part$ = %GLOBAL%$part$$desc_id$ = (%GLOBAL%$part_struct$->$desc_id$)$no_rebuild$	:i $SetCASAppearancePartInstance$$part$ = %GLOBAL%$part$$part_instance$ = %GLOBAL%$part_struct$	:i endfunction]Script cas_set_random_presets dbc83a41 [	${Unknown [0001260038b8f5bd696969690000001800012600f229e767696969690000002800012b008556d2906969696900000000]}$	:i if $StructureContains$$structure$ = %GLOBAL%$chosen_setup$%GLOBAL%$preset_type$		:i $cas_get_preset_index$$preset_type$ = %GLOBAL%$preset_type$$gender$ = %GLOBAL%$gender$$desc_id$ = (%GLOBAL%$chosen_setup$->%GLOBAL%$preset_type$)		:i $cas_apply_preset$:s{			:i $preset_type$ = %GLOBAL%$preset_type$			:i $preset_index$ = %GLOBAL%$preset_index$			:i $gender$ = %GLOBAL%$gender$		:i :s}		:i if (%GLOBAL%$preset_type$ = $car_presets_outfit$)			:i if $ResolveBodySpecificPartInAppearance$${StructQBKey part = CAS_Hat}$				:i %GLOBAL%$preset_struct$ = ((~%GLOBAL%$preset_type$->%GLOBAL%$gender$):a{%GLOBAL%$preset_index$:a})				:i if $StructureContains$$structure$ = %GLOBAL%$preset_struct$%GLOBAL%$part$					:i if $GetCASAppearancePartDescID$$part$ = %GLOBAL%$part$						:i $cas_disq_resolve_hat_hair$$part$ = %GLOBAL%$part$$desc_id$ = %GLOBAL%$desc_id$					:i endif				:i endif			:i endif		:i endif	:i endif	:i endfunction]Script cas_get_preset_index a270fa84 [	${Unknown [00012600f229e76769696969000000180001260038b8f5bd6969696900000028000126004bb2084e6969696900000000]}$	:i %GLOBAL%$preset_array$ = (~%GLOBAL%$preset_type$->%GLOBAL%$gender$)	:i $GetArraySize$%GLOBAL%$preset_array$	:i %GLOBAL%$i$ = %i(0)	:i while 	:i if ((%GLOBAL%$preset_array$:a{%GLOBAL%$i$:a}->$desc_id$) = %GLOBAL%$desc_id$)		:i return $true$$preset_index$ = %GLOBAL%$i$	:i endif	:i %GLOBAL%$i$ = (%GLOBAL%$i$ + %i(1))	:i loop_to %GLOBAL%$array_size$	:i $scriptassert$%s("Preset %a not found in %b %c")$a$ = %GLOBAL%$desc_id$$b$ = %GLOBAL%$preset_type$$c$ = %GLOBAL%$gender$	:i return ${StructQBKey false}$	:i endfunction]Script cas_set_random_avatar_instrument 0x79cc3d5d [	:i $change$$cas_dupe_appearance$ = (~$cas_current_appearance$)	:i $cas_grab_random_unlocks$	:i $randomize$	:i $cas_generate_all_random_instruments$$is_female$ = %GLOBAL%$is_female$$genre$ = %GLOBAL%$genre$	:i $change$${		StructArray cas_current_unlock_list		{			Floats [0.00000, 0.00000]		}	}$		:i $change$${		StructStruct cas_dupe_appearance		{			StructHeader {}		}	}$		:i endfunction]Script cas_grab_random_unlocks 0x076ce3da [	:i if (~$cpu_random_character$ = %i(0) AND ~$cas_current_savegame$ >= %i(0))		:i $GetGlobalTags$$unlocked_cas_items$$savegame$ = (~$cas_current_savegame$)		:i $change$$cas_current_unlock_list$ = %GLOBAL%$unlocked_cas_items$	:i else 		:i $change$${			StructArray cas_current_unlock_list			{				Floats [0.00000, 0.00000]			}		}$			:i endif	:i endfunction]Script cas_generate_all_random_instruments faf72c37 [	:i $cas_merge_in_random_entry$(~$cas_randomized_instruments$->$guitar$)$is_female$ = %GLOBAL%$is_female$$genre$ = %GLOBAL%$genre$	:i $cas_merge_in_random_entry$(~$cas_randomized_instruments$->$Bass$)$is_female$ = %GLOBAL%$is_female$$genre$ = %GLOBAL%$genre$	:i $cas_merge_in_random_entry$(~$cas_randomized_instruments$->$drum$)$is_female$ = %GLOBAL%$is_female$$genre$ = %GLOBAL%$genre$	:i $cas_merge_in_random_entry$(~$cas_randomized_instruments$->$Vocals$)$is_female$ = %GLOBAL%$is_female$$genre$ = %GLOBAL%$genre$	:i endfunction]Script cas_set_random_appearance_part d5498adc [	:i $part$ = (%GLOBAL%$part_struct$->$part$)	:i $ResolveBodySpecificPartInAppearance$$part$ = %GLOBAL%$part$	:i $part_array$ = (~%GLOBAL%$part$)	:i $GetArraySize$%GLOBAL%$part_array$	:i if $ChooseRandomCASPart$$part_name$ = %GLOBAL%$part$$genre$ = %GLOBAL%$genre$		:i $desc_id$ = (%GLOBAL%$random_part$->$desc_id$)		:i $cas_handle_disqualifications$$part$ = %GLOBAL%$part$$desc_id$ = %GLOBAL%$desc_id$		:i if $GotParam$${StructQBKey new_desc_id}$			:i $desc_id$ = %GLOBAL%$new_desc_id$		:i endif		:i $EditCASAppearance$$target$ = $setpart$$targetParams$ = :s{$part$ = %GLOBAL%$part$$desc_id$ = %GLOBAL%$desc_id$:s}	:i endif	:i endfunction]Script cas_random_should_include_part cf83f5b7 [	:i if (%GLOBAL%$locked$ = %i(1))		:i if (~$cpu_random_character$ = %i(0))			:i $MangleChecksums$$a$ = %GLOBAL%$desc_id$$b$ = %GLOBAL%$part_name$			:i if NOT $ArrayContains$$array$ = (~$cas_current_unlock_list$)$contains$ = %GLOBAL%$mangled_id$				:i return ${StructQBKey false}$			:i endif		:i endif	:i endif	:i if (%GLOBAL%$make_unique$ = %i(1))		:i if $StructureContains$$structure$ = ~$cas_band_used_parts$%GLOBAL%$part_name$			:i if NOT (%GLOBAL%$desc_id$ = $None$)				:i if $ArrayContains$$array$ = (~$cas_band_used_parts$->%GLOBAL%$part_name$)$contains$ = %GLOBAL%$desc_id$					:i return ${StructQBKey false}$				:i endif			:i endif		:i endif	:i endif	:i return ${StructQBKey true}$	:i endfunction]Script cas_set_random_color_part fa44630c [	:i $part$ = (%GLOBAL%$part_struct$->$part$)	:i if (%GLOBAL%$part$ = $CAS_Facial_Hair$)		:i return 	:i endif	:i $ResolveBodySpecificPartInAppearance$$part$ = %GLOBAL%$part$	:i if $GetCASAppearancePartDescID$$part$ = %GLOBAL%$part$		:i if $GetCASPartMaterials$$part$ = %GLOBAL%$part$			:i $GetArraySize$%GLOBAL%$part_materials$			:i $i$ = %i(0)			:i while 			:i if $cas_pick_random_color$$part$ = %GLOBAL%$part$$desc_id$ = %GLOBAL%$desc_id$$genre$ = %GLOBAL%$genre$				:i $SetCASAppearanceMaterial$$part$ = %GLOBAL%$part$$material$ = ((%GLOBAL%$part_materials$:a{%GLOBAL%$i$:a})->$desc_id$)$value$ = %GLOBAL%$color$				:i if (%GLOBAL%$part$ = $CAS_Male_Hair$)					:i $set_facial_hair_color$$part$ = $CAS_Male_Facial_Hair$$color$ = %GLOBAL%$color$				:i endif			:i endif			:i $i$ = (%GLOBAL%$i$ + %i(1))			:i loop_to %GLOBAL%$array_size$		:i endif	:i endif	:i endfunction]Script set_facial_hair_color 0x914a1c4f [	:i if $GetCASPartMaterials$$part$ = %GLOBAL%$part$		:i $GetArraySize$%GLOBAL%$part_materials$		:i $i$ = %i(0)		:i while 		:i $SetCASAppearanceMaterial$$part$ = %GLOBAL%$part$$material$ = ((%GLOBAL%$part_materials$:a{%GLOBAL%$i$:a})->$desc_id$)$value$ = %GLOBAL%$color$		:i $i$ = (%GLOBAL%$i$ + %i(1))		:i loop_to %GLOBAL%$array_size$	:i endif	:i endfunction]Script cas_can_pick_random_color 0x5dcd751d [	:i if $GotParam$${StructQBKey desc_id}$		:i $GetActualCASOptionStruct$$part$ = %GLOBAL%$part$$desc_id$ = %GLOBAL%$desc_id$		:i if $GotParam$${StructQBKey random_colors}$			:i return $true$$rand_colors$ = (%GLOBAL%$random_colors$)		:i elseif $GotParam$${StructQBKey force_random}$			:i $GetArraySize$${StructQBString cas_randomized_parts}$			:i $i$ = %i(0)			:i while 			:i if $ChecksumEquals$$a$ = ((~$cas_randomized_parts$:a{%GLOBAL%$i$:a})->$part$)$b$ = %GLOBAL%$part$				:i if $StructureContains$$structure$ = (~$cas_randomized_parts$:a{%GLOBAL%$i$:a})$force_random_colors$					:i return $true$$rand_colors$ = ((~$cas_randomized_parts$:a{%GLOBAL%$i$:a})->$force_random_colors$)				:i endif				:i return ${StructQBKey false}$			:i endif			:i $i$ = (%GLOBAL%$i$ + %i(1))			:i loop_to %GLOBAL%$array_size$		:i endif	:i endif	:i return ${StructQBKey false}$	:i endfunction]Script cas_pick_random_color 0x12408b06 [	:i if $cas_can_pick_random_color$ isNull 		:i if $ChooseRandomPresetByGenre$$localarray$ = %GLOBAL%$rand_colors$$genre$ = %GLOBAL%$genre$			:i if $StructureContains$$structure$ = %GLOBAL%$random_preset$$color$				:i $printf$%s("Set Random color for %s")$s$ = %GLOBAL%$part$$DoNotResolve$				:i return $true$$color$ = (%GLOBAL%$random_preset$->$color$)			:i endif		:i endif	:i endif	:i return ${StructQBKey false}$	:i endfunction]Script cas_random_handle_exclusions ffffffff [	:i endfunction]Script cas_random_handle_exclusions_scanner ffffffff [	:i endfunction]Script cas_random_find_exclusion ffffffff [	:i endfunction]Script cas_do_randomize_presets ffffffff [	:i endfunction]Script cas_merge_in_cap 0x0d1e8046 [	:i $existing_cap$ = :a{:a}	:i if $StructureContains$$structure$ = %GLOBAL%$existing_part$$cap$		:i $existing_cap$ = (%GLOBAL%$existing_part$->$cap$)	:i endif	:i $i$ = %i(0)	:i $GetArraySize$%GLOBAL%$cap_merge$	:i if (%GLOBAL%$array_size$ > %i(0))		:i while 		:i $cas_merge_in_cap_foreach$$existing_cap$ = %GLOBAL%$existing_cap$$cap_entry$ = (%GLOBAL%$cap_merge$:a{%GLOBAL%$i$:a})		:i $i$ = (%GLOBAL%$i$ + %i(1))		:i loop_to %GLOBAL%$array_size$	:i endif	:i $GetArraySize$%GLOBAL%$existing_cap$	:i if (%GLOBAL%$array_size$ = %i(0))		:i $RemoveParameter$${StructQBKey existing_cap}$	:i endif	:i return $merge_in$ = :s{%GLOBAL%$existing_part$$cap$ = %GLOBAL%$existing_cap$:s}	:i endfunction]Script cas_merge_in_cap_foreach 0x245a81a6 [	:i if $StructureContains$$structure$ = %GLOBAL%$cap_entry$$base_tex$		:i $new_base_tex$ = (%GLOBAL%$cap_entry$->$base_tex$)		:i $i$ = %i(0)		:i $GetArraySize$%GLOBAL%$existing_cap$		:i if (%GLOBAL%$array_size$ > %i(0))			:i while 			:i if $StructureContains$$structure$ = (%GLOBAL%$existing_cap$:a{%GLOBAL%$i$:a})$base_tex$				:i if ((%GLOBAL%$existing_cap$:a{%GLOBAL%$i$:a}->$base_tex$) = %GLOBAL%$new_base_tex$)					:i return 				:i endif			:i endif			:i $i$ = (%GLOBAL%$i$ + %i(1))			:i loop_to %GLOBAL%$array_size$		:i endif		:i $AddArrayElement$$array$ = %GLOBAL%$existing_cap$$element$ = %GLOBAL%$cap_entry$		:i return $existing_cap$ = %GLOBAL%$array$	:i endif	:i endfunction]Script check_dupe_appearance d3c64a50 [	:i $RequireParams$${		StructArray 0x00000000		{			ArrayQBKey			[				avoid_dupe_parts				random_preset			]		}		StructQBKey all	}$		:i $GetArraySize$%GLOBAL%$avoid_dupe_parts$	:i if (%GLOBAL%$array_size$ > %i(0))		:i $i$ = %i(0)		:i while 		:i $part$ = (%GLOBAL%$avoid_dupe_parts$:a{%GLOBAL%$i$:a})		:i $ResolveBodySpecificPartInAppearance$$part$ = %GLOBAL%$part$		:i if NOT $StructureContains$$structure$ = %GLOBAL%$random_preset$%GLOBAL%$part$			:i return ${StructQBKey false}$		:i endif		:i $desc_id$ = (%GLOBAL%$random_preset$->%GLOBAL%$part$->$desc_id$)		:i if NOT $StructureContains$$structure$ = (~$cas_dupe_appearance$)%GLOBAL%$part$			:i return ${StructQBKey false}$		:i endif		:i $app_desc_id$ = ((~$cas_dupe_appearance$)->%GLOBAL%$part$->$desc_id$)		:i if (%GLOBAL%$desc_id$ !== %GLOBAL%$app_desc_id$)			:i return ${StructQBKey false}$		:i endif		:i $i$ = (%GLOBAL%$i$ + %i(1))		:i loop_to %GLOBAL%$array_size$	:i endif	:i $printf$${StructString 0x00000000 = "check_dupe_appearance - Appearance matches!"}$	:i return ${StructQBKey true}$	:i endfunction]Script cas_merge_in_random_entry 0x34104d4e [	:i if $GotParam$${StructQBKey female_array}$		:i if (%GLOBAL%$is_female$ = %i(1))			:i $chosen_array$ = %GLOBAL%$female_array$		:i else 			:i $chosen_array$ = %GLOBAL%$male_array$		:i endif	:i else 		:i $chosen_array$ = %GLOBAL%$array$	:i endif	:i $iLoop$ = %i(0)	:i while 	:i if $ChooseRandomPresetByGenre$$globalarray$ = %GLOBAL%$chosen_array$$genre$ = %GLOBAL%$genre$		:i $RemoveComponent$${			StructQBKey structure_name = random_preset			StructQBKey name = random_weight		}$				:i $RemoveComponent$${			StructQBKey structure_name = random_preset			StructQBKey name = genre		}$				:i if $GotParam$${StructQBKey avoid_dupe_parts}$			:i if NOT $check_dupe_appearance$$avoid_dupe_parts$ = %GLOBAL%$avoid_dupe_parts$$random_preset$ = %GLOBAL%$random_preset$				:i $no_dupes$ = %i(1)			:i endif		:i else 			:i $no_dupes$ = %i(1)		:i endif		:i if (%GLOBAL%$iLoop$ = %i(10))			:i $no_dupes$ = %i(1)		:i endif		:i if $GotParam$${StructQBKey no_dupes}$			:i $change$$cas_current_appearance$ = :s{(~$cas_current_appearance$)%GLOBAL%$random_preset$:s}			:i if $ResolveBodySpecificPartInAppearance$${StructQBKey part = CAS_Hat}$				:i if $StructureContains$$structure$ = %GLOBAL%$random_preset$%GLOBAL%$part$					:i if $GetCASAppearancePartDescID$$part$ = %GLOBAL%$part$						:i $cas_disq_resolve_hat_hair$$part$ = %GLOBAL%$part$$desc_id$ = %GLOBAL%$desc_id$					:i endif				:i endif			:i endif			:i return 		:i else 			:i $printf$%s("Avoided duped parts %d")$d$ = %GLOBAL%$iLoop$		:i endif	:i endif	:i $iLoop$ = (%GLOBAL%$iLoop$ + %i(1))	:i loop_to 	:i endfunction]Script cas_generate_new_random_instrument a67bee3a [	:i $change$$cas_dupe_appearance$ = (~$cas_current_appearance$)	:i $cas_grab_random_unlocks$	:i $randomize$	:i $RequireParams$${		StructArray 0x00000000		{			ArrayQBKey			[				type			]		}		StructQBKey all	}$		:i switch %GLOBAL%$type$		:i case $guitar$			:i $avoid_dupe_parts$ = :a{$CAS_Guitar_Body$$CAS_Guitar_Head$:a}			:i endcase		case $Bass$			:i $avoid_dupe_parts$ = :a{$CAS_Bass_Body$$CAS_Bass_Head$:a}			:i endcase		case $drum$			:i $avoid_dupe_parts$ = :a{$CAS_Drums$:a}			:i endcase		case $Vocals$			:i $avoid_dupe_parts$ = :a{$CAS_Mic_Stand$$CAS_Mic$:a}	:i end_switch	:i $get_is_female_from_appearance$$appearance$ = (~$cas_current_appearance$)	:i $cas_merge_in_random_entry$:s{		:i (~$cas_randomized_instruments$->%GLOBAL%$type$)		:i $is_female$ = %GLOBAL%$is_female$		:i $genre$ = $any$		:i $avoid_dupe_parts$ = %GLOBAL%$avoid_dupe_parts$		:i $avoid_dupe_appearance$ = %GLOBAL%$avoid_dupe_appearance$	:i :s}	:i $change$${		StructArray cas_current_unlock_list		{			Floats [0.00000, 0.00000]		}	}$		:i $change$${		StructStruct cas_dupe_appearance		{			StructHeader {}		}	}$		:i endfunction]Script remove_locked_cas_textures c00fa419 [	:i $GetArraySize$%GLOBAL%$array$	:i if (%GLOBAL%$array_size$ > %i(0))		:i $i$ = %i(0)		:i while 		:i if $StructureContains$$structure$ = (%GLOBAL%$array$:a{%GLOBAL%$i$:a})$locked$			:i if NOT $check_cas_texture_unlocked_flag$$savegame$ = (~$cas_current_savegame$)$texture$ = (%GLOBAL%$array$:a{%GLOBAL%$i$:a}->$pattern$)				:i $is_locked$ = %i(1)			:i endif		:i endif		:i if $GotParam$${StructQBKey is_locked}$			:i $RemoveArrayElement$$array$ = %GLOBAL%$array$$index$ = %GLOBAL%$i$			:i $RemoveParameter$${StructQBKey is_locked}$			:i $printf$%s("remove_locked_cas_textures: Removed texture index %d")$d$ = %GLOBAL%$i$		:i else 			:i $i$ = (%GLOBAL%$i$ + %i(1))		:i endif		:i loop_to %GLOBAL%$array_size$	:i endif	:i return $mask$ = %GLOBAL%$array$	:i endfunction]Script random_instrument_piece 0x47b95a73 [	:i $printf$%s("random_instrument_piece %p")$p$ = %GLOBAL%$part$$DoNotResolve$	:i if NOT $random_instrument_piece_do_inclusions$$inc$ = %GLOBAL%$inc$$part$ = %GLOBAL%$part$		:i $cas_set_random_appearance_part$$part_struct$ = :s{$part$ = %GLOBAL%$part$:s}$genre$ = $any$	:i endif	:i if $GetCAPSectionsArray$$appearance$ = ~$cas_current_appearance$$part$ = %GLOBAL%$part$		:i $num_found$ = %i(0)		:i $printf$%s("Found sections in instrument piece %p")$p$ = %GLOBAL%$part$$DoNotResolve$		:i $GetArraySize$%GLOBAL%$sections$		:i if (%GLOBAL%$array_size$ > %i(0))			:i $i$ = %i(0)			:i while 			:i $desc_id$ = (%GLOBAL%$sections$:a{%GLOBAL%$i$:a}->$desc_id$)			:i if ((%GLOBAL%$desc_id$ = $Finishes$) OR (%GLOBAL%$desc_id$ = $Details$))				:i $num_found$ = (%GLOBAL%$num_found$ + %i(1))				:i if (%GLOBAL%$num_found$ > %i(2))					:i $scriptassert$${StructString 0x00000000 = "this only handles two layers, logic needs to be more complex for more"}$				:i endif				:i $printf$%s("Found %d section in instrument piece")$d$ = %GLOBAL%$desc_id$$DoNotResolve$				:i $mask$ = (%GLOBAL%$sections$:a{%GLOBAL%$i$:a}->$mask$)				:i $remove_locked_cas_textures$$array$ = %GLOBAL%$mask$				:i if $PickFromWeightedArray$$weighted_array$ = %GLOBAL%$mask$					:i $printf$%s("Picked index %i")$i$ = %GLOBAL%$random_index$$DoNotResolve$					:i $base_tex$ = (%GLOBAL%$sections$:a{%GLOBAL%$i$:a}->$base_tex$)					:i $chosen_mask$ = (%GLOBAL%$mask$:a{%GLOBAL%$random_index$:a})					:i $printf$%s("Frontend desc is %s")$s$ = (%GLOBAL%$chosen_mask$->$frontend_desc$)$DoNotResolve$					:i if NOT $StructureContains$$structure$ = (%GLOBAL%$sections$:a{%GLOBAL%$i$:a})$diffuse$						:i $scriptassert$${StructString 0x00000000 = "Instrument defs all need to be on diffuse"}$					:i endif					:i if NOT $StructureContains$$structure$ = (%GLOBAL%$sections$:a{%GLOBAL%$i$:a})$pre_userlayer$						:i $scriptassert$${StructString 0x00000000 = "Instrument defs all need to be pre_userlayer"}$					:i endif					:i $name$ = (%GLOBAL%$chosen_mask$->$pattern$)					:i $material$ = (%GLOBAL%$sections$:a{%GLOBAL%$i$:a}->$material$)					:i $new_cap_entry$ = %i(1)					:i if $GotParam$${StructQBKey last_base_tex}$						:i if (%GLOBAL%$last_base_tex$ = %GLOBAL%$base_tex$)							:i $new_cap_entry$ = %i(0)							:i if NOT (%GLOBAL%$last_material$ = %GLOBAL%$material$)								:i $scriptassert$%s("material mismatch %a != %b")$a$ = %GLOBAL%$last_material$$b$ = %GLOBAL%$material$$DoNotResolve$							:i endif						:i endif					:i endif					:i if $StructureContains$$structure$ = %GLOBAL%$chosen_mask$$no_color$						:i $RemoveParameter$${StructQBKey color}$					:i else 						:i $cas_pick_random_colorwheel$					:i endif					:i $set_cap_flags$$mask$ = %GLOBAL%$chosen_mask$					:i $new_entry$ = :s{						:i $texture$ = %GLOBAL%$name$						:i $flags$ = %GLOBAL%$flags$						:i $color$ = %GLOBAL%$color$					:i :s}					:i if (%GLOBAL%$new_cap_entry$ = %i(0))						:i $CAP_array$ = :a{							:i :s{								:i $base_tex$ = %GLOBAL%$base_tex$								:i $material$ = %GLOBAL%$material$								:i $diffuse$								:i $pre_layer$ = :a{									:i :s{										:i %GLOBAL%$last_entry$									:i :s}									:i :s{										:i %GLOBAL%$new_entry$									:i :s}								:i :a}							:i :s}						:i :a}					:i else 						:i $cap_entry$ = :a{							:i :s{								:i $base_tex$ = %GLOBAL%$base_tex$								:i $material$ = %GLOBAL%$material$								:i $diffuse$								:i $pre_layer$ = :a{									:i :s{										:i %GLOBAL%$new_entry$									:i :s}								:i :a}							:i :s}						:i :a}						:i if $GotParam$${StructQBKey CAP_array}$							:i $CAP_array$ = (%GLOBAL%$CAP_array$ + %GLOBAL%$cap_entry$)						:i else 							:i $CAP_array$ = %GLOBAL%$cap_entry$						:i endif					:i endif					:i $last_base_tex$ = %GLOBAL%$base_tex$					:i $last_material$ = %GLOBAL%$material$					:i $last_entry$ = %GLOBAL%$new_entry$				:i endif			:i endif			:i $i$ = (%GLOBAL%$i$ + %i(1))			:i loop_to %GLOBAL%$array_size$		:i endif	:i endif	:i if $GotParam$${StructQBKey CAP_array}$		:i $printstruct$%GLOBAL%$CAP_array$		:i $SetCASAppearanceCAP$$part$ = %GLOBAL%$part$$cap$ = %GLOBAL%$CAP_array$	:i else 		:i $SetCASAppearanceCAP$$part$ = %GLOBAL%$part$	:i endif	:i $printf$${StructString 0x00000000 = ""}$	:i endfunction]Script random_instrument_piece_do_inclusions 0x58fc5722 [	:i if $GotParam$${StructQBKey inc}$		:i $GetCASAppearancePartDescID$$part$ = %GLOBAL%$inc$		:i $GetActualCASOptionStruct$$part$ = %GLOBAL%$inc$$desc_id$ = %GLOBAL%$desc_id$		:i if $GotParam$${StructQBKey Inclusion}$			:i $printf$%s("Inclusion list for %i->%d...")$i$ = %GLOBAL%$inc$$d$ = %GLOBAL%$part$$DoNotResolve$			:i $GetArraySize$%GLOBAL%$Inclusion$			:i if (%GLOBAL%$array_size$ > %i(0))				:i $i$ = %i(0)				:i while 				:i if (%GLOBAL%$Inclusion$:a{%GLOBAL%$i$:a}->$part$ = %GLOBAL%$part$)					:i $printf$${StructString 0x00000000 = "Found!"}$					:i $array$ = (%GLOBAL%$Inclusion$:a{%GLOBAL%$i$:a}->$valid$)					:i $trim_inclusion_array$$inclusion_array$ = %GLOBAL%$array$$part$ = %GLOBAL%$part$					:i if $random_instrument_pick_from_array$$array$ = %GLOBAL%$array$						:i $printf$%s("Using %a %b")$a$ = %GLOBAL%$part$$b$ = %GLOBAL%$element$						:i $EditCASAppearance$$target$ = $setpart$$targetParams$ = :s{$part$ = %GLOBAL%$part$$desc_id$ = %GLOBAL%$element$:s}						:i return ${StructQBKey true}$					:i endif				:i endif				:i $i$ = (%GLOBAL%$i$ + %i(1))				:i loop_to %GLOBAL%$array_size$			:i endif			:i $printf$%s("Inclusion not found, clearing %a")$a$ = %GLOBAL%$part$			:i $EditCASAppearance$$target$ = $clearpart$$targetParams$ = :s{$part$ = %GLOBAL%$part$:s}			:i return ${StructQBKey true}$		:i endif	:i endif	:i return ${StructQBKey false}$	:i endfunction]Script random_instrument_pick_from_array 0x0097b7f3 [	:i $GetArraySize$%GLOBAL%$array$	:i if (%GLOBAL%$array_size$ = %i(0))		:i return ${StructQBKey false}$	:i endif	:i $GetRandomArrayElement$%GLOBAL%$array$	:i return $true$$element$ = %GLOBAL%$element$	:i endfunction]Script random_cas_piece_unlocked 0x3caf5ca0 [	:i $GetActualCASOptionStruct$$part$ = %GLOBAL%$part$$desc_id$ = %GLOBAL%$desc_id$	:i if $GotParam$${StructQBKey locked}$		:i $MangleChecksums$$a$ = %GLOBAL%$desc_id$$b$ = %GLOBAL%$part$		:i if NOT $ArrayContains$$array$ = (~$cas_current_unlock_list$)$contains$ = %GLOBAL%$mangled_id$			:i return ${StructQBKey false}$		:i endif	:i endif	:i return ${StructQBKey true}$	:i endfunction]Script trim_inclusion_array 0x44e08752 [	:i $array$ = :a{:a}	:i $GetArraySize$%GLOBAL%$inclusion_array$	:i if (%GLOBAL%$array_size$ > %i(0))		:i $i$ = %i(0)		:i while 		:i $valid_part$ = (%GLOBAL%$inclusion_array$:a{%GLOBAL%$i$:a})		:i if $random_cas_piece_unlocked$$part$ = %GLOBAL%$part$$desc_id$ = %GLOBAL%$valid_part$			:i $AddArrayElement$$array$ = %GLOBAL%$array$$element$ = %GLOBAL%$valid_part$		:i endif		:i $i$ = (%GLOBAL%$i$ + %i(1))		:i loop_to %GLOBAL%$array_size$	:i endif	:i return $array$ = %GLOBAL%$array$	:i endfunction]Script cas_pick_random_colorwheel 0x6f90db00 [	${StructQBString wheel = guitar_colorwheel}$	:i $GetArraySize$%GLOBAL%$wheel$	:i $getrandomvalue$$name$ = $index$$integer$$a$ = %i(0)$b$ = (%GLOBAL%$array_size$%i(4294967295))	:i $wheel_entry$ = (%GLOBAL%$wheel$:a{%GLOBAL%$index$:a})	:i $GetRandomArrayElement$%GLOBAL%$wheel_entry$	:i return $color$ = %GLOBAL%$element$	:i endfunction]